<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>kohler2025</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="kohler2025_files/libs/clipboard/clipboard.min.js"></script>
<script src="kohler2025_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="kohler2025_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="kohler2025_files/libs/quarto-html/popper.min.js"></script>
<script src="kohler2025_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="kohler2025_files/libs/quarto-html/anchor.min.js"></script>
<link href="kohler2025_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="kohler2025_files/libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="kohler2025_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="kohler2025_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="kohler2025_files/libs/bootstrap/bootstrap-81267100e462c21b3d6c0d5bf76a3417.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="kohler2025_files/libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="kohler2025_files/libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<script src="kohler2025_files/libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="kohler2025_files/libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="kohler2025_files/libs/leaflet-1.3.1/leaflet.js"></script>
<link href="kohler2025_files/libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="kohler2025_files/libs/proj4-2.6.2/proj4.min.js"></script>
<script src="kohler2025_files/libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="kohler2025_files/libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="kohler2025_files/libs/leaflet-binding-2.2.2/leaflet.js"></script>
<script src="kohler2025_files/libs/leaflet-providers-2.0.0/leaflet-providers_2.0.0.js"></script>
<script src="kohler2025_files/libs/leaflet-providers-plugin-2.2.2/leaflet-providers-plugin.js"></script>
<script src="kohler2025_files/libs/HomeButton-0.0.1/home-button.js"></script>
<script src="kohler2025_files/libs/HomeButton-0.0.1/easy-button-src.min.js"></script>
<link href="kohler2025_files/libs/Region-CSS-0.0.1/Region_home-button.css" rel="stylesheet">
<script src="kohler2025_files/libs/clipboard-0.0.1/setClipboardText.js"></script>
<link href="kohler2025_files/libs/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet">
<link href="kohler2025_files/libs/mapviewCSS-0.0.1/mapview.css" rel="stylesheet">
<link href="kohler2025_files/libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="kohler2025_files/libs/pagedtable-1.1/js/pagedtable.js"></script>


</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#study-regions" id="toc-study-regions" class="nav-link active" data-scroll-target="#study-regions">Study Regions</a></li>
  <li><a href="#the-vepiin-study-area" id="toc-the-vepiin-study-area" class="nav-link" data-scroll-target="#the-vepiin-study-area">The VEPIIN Study Area</a>
  <ul class="collapse">
  <li><a href="#the-chaco-regional-system" id="toc-the-chaco-regional-system" class="nav-link" data-scroll-target="#the-chaco-regional-system">The Chaco Regional System</a></li>
  </ul></li>
  <li><a href="#dryland-maize-farming-niche" id="toc-dryland-maize-farming-niche" class="nav-link" data-scroll-target="#dryland-maize-farming-niche">Dryland Maize Farming Niche</a></li>
  <li><a href="#modeling-pre-european-net-primary-productivity" id="toc-modeling-pre-european-net-primary-productivity" class="nav-link" data-scroll-target="#modeling-pre-european-net-primary-productivity">Modeling pre-European Net Primary Productivity</a>
  <ul class="collapse">
  <li><a href="#data-preparation" id="toc-data-preparation" class="nav-link" data-scroll-target="#data-preparation">Data preparation</a></li>
  <li><a href="#estimating-pre-european-net-primary-productivity-npp-using-gradient-boosted-models" id="toc-estimating-pre-european-net-primary-productivity-npp-using-gradient-boosted-models" class="nav-link" data-scroll-target="#estimating-pre-european-net-primary-productivity-npp-using-gradient-boosted-models">Estimating Pre-European Net Primary Productivity (NPP) Using Gradient Boosted Models</a></li>
  <li><a href="#calculating-relative-maize-productivity-by-region" id="toc-calculating-relative-maize-productivity-by-region" class="nav-link" data-scroll-target="#calculating-relative-maize-productivity-by-region">Calculating Relative Maize Productivity by Region</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">




<p>This R-based research compendium supports an analysis of climate variability and its impact on ancestral Pueblo demography in the Chaco Regional System. It draws on high-resolution paleoclimate reconstructions and spatial regional boundaries to estimate the frequency and duration of agricultural potential over time, and their relationship to the demography of the region.</p>
<p>View the raw source code and output at: <a href="https://github.com/bocinsky/kohler2025">https://github.com/bocinsky/kohler2025</a></p>
<section id="study-regions" class="level2">
<h2 class="anchored" data-anchor-id="study-regions">Study Regions</h2>
</section>
<section id="the-vepiin-study-area" class="level2">
<h2 class="anchored" data-anchor-id="the-vepiin-study-area">The VEPIIN Study Area</h2>
<p>The VEPIIN study area in the Central Mesa Verde region was somewhat arbitrarily defined to encompass the great Sage Plin, Mesa Verde National Park, and Canyons of the Ancients National Monument, as well as the expend of hte Dolores Archaeological Program in Southwestern Colorado. Was aligned to the NAD83 UTM zone 12N coordinate reference system, and sedigned such that even numbers 200m-by-200m might be included along each axis.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="do">## This creates a geojson of the VEPIIN study area</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(<span class="st">"data-raw/vepiin.geojson"</span>))</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="at">xmin =</span> <span class="dv">672800</span>, </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">xmax =</span> <span class="dv">740000</span>, </span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymin =</span> <span class="dv">4102000</span>, </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymax =</span> <span class="dv">4170000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_bbox</span>(<span class="at">crs =</span> <span class="dv">26912</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_as_sfc</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_transform</span>(<span class="st">"EPSG:4326"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">write_sf</span>(<span class="st">"data-raw/vepiin.geojson"</span>,</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">delete_dsn =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="the-chaco-regional-system" class="level3">
<h3 class="anchored" data-anchor-id="the-chaco-regional-system">The Chaco Regional System</h3>
<p>As described in the main paper, we develop boundaried for the spatial extent of the Chaco Regional System using a database of Chacoan outlier sites compiled by Van Dyke and colleagues (2016). We eliminated all site types other than great houses, and sorted the sites into temporal groups. We then categorized the sites as being included in one or several of our time periods: Early, Late, and Post-Chaco. Sites are included in more than one of these groups if their occupations spanned the temporal cut-offs.</p>
<p>The Early Chaco group contains 60 sites with occupation at any point between 850-1039, including sites whose occupations continue after 1039, so long as the initial occupation occurred prior to 1039. (All dates herein are AD/CE).</p>
<p>The Late Chaco group contains 168 sites with occupation between 1040 and 1149, including sites whose occupations began before and/or continued after these dates.</p>
<p>The Post-Chaco group contains 107 sites with occupation from 1150 to 1300; this includes great houses that were constructed during the two earlier CRS periods as well as great houses with initial construction between 1150 and 1300.</p>
<p>Brumbaugh developed a method, detailed in the main paper, to generate a reasonable boundary for the Chaco Regional System during each period. Briefly, we removed border sites that lacked definitive Chacoan architectural attributes, then used ArcGIS Pro to buffer each site by one kilometerand define a concave hull of threshold 0.7 around the sites.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>chaco_regions <span class="ot">&lt;-</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="st">`</span><span class="at">E CRS (850–1040)</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"data-raw/EarlyChacoRegion_LatLong.geojson"</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>       <span class="st">`</span><span class="at">L CRS (1040–1150)</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"data-raw/LateChacoRegion_LatLong.geojson"</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>       <span class="st">`</span><span class="at">P CRS (1150–1300)</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"data-raw/PostChacoRegion_LatLong.geojson"</span>,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>       <span class="st">`</span><span class="at">VEPIIN (850–1300)</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"data-raw/vepiin.geojson"</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map_dfr</span>(sf<span class="sc">::</span>read_sf, <span class="at">.id =</span> <span class="st">"region"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(region) <span class="sc">%&gt;%</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_transform</span>(<span class="st">"EPSG:4269"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_cast</span>(<span class="st">"MULTIPOLYGON"</span>)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>chaco_region_colors <span class="ot">&lt;-</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(paletteer<span class="sc">::</span><span class="fu">paletteer_c</span>(<span class="st">"scico::batlow"</span>, <span class="at">n =</span> <span class="dv">4</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>],<span class="st">"black"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  magrittr<span class="sc">::</span><span class="fu">set_names</span>(</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>      <span class="st">"E CRS (850–1040)"</span>,</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>      <span class="st">"L CRS (1040–1150)"</span>,</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>      <span class="st">"P CRS (1150–1300)"</span>,</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>      <span class="st">"VEPIIN (850–1300)"</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>chaco_regions <span class="sc">%&gt;%</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Region =</span> region,</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>                <span class="at">Area =</span> sf<span class="sc">::</span><span class="fu">st_area</span>(geometry) <span class="sc">%&gt;%</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>                  units<span class="sc">::</span><span class="fu">set_units</span>(<span class="st">"km^2"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">round</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Region, Area)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["Region"],"name":[1],"type":["chr"],"align":["left"]},{"label":["Area"],"name":[2],"type":["units"],"align":["right"]}],"data":[{"1":"E CRS (850–1040)","2":"21557 [km^2]"},{"1":"L CRS (1040–1150)","2":"64875 [km^2]"},{"1":"P CRS (1150–1300)","2":"60161 [km^2]"},{"1":"VEPIIN (850–1300)","2":"4566 [km^2]"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>mapview<span class="sc">::</span><span class="fu">mapview</span>(chaco_regions,</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> chaco_region_colors,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">col.regions =</span> chaco_region_colors,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">alpha.regions =</span> <span class="dv">0</span>,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">lwd =</span> <span class="dv">3</span>,</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">layer.name =</span> <span class="st">"Region"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell" data-layout-align="center">
<div id="fig-map-regions" class="cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-map-regions-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="leaflet html-widget html-fill-item" id="htmlwidget-5c1e2f1abd6712eb499b" style="width:100%;height:260px;"></div>
<script type="application/json" data-for="htmlwidget-5c1e2f1abd6712eb499b">{"x":{"options":{"minZoom":1,"maxZoom":52,"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"preferCanvas":false,"bounceAtZoomLimits":false,"maxBounds":[[[-90,-370]],[[90,370]]]},"calls":[{"method":"addProviderTiles","args":["CartoDB.Positron","CartoDB.Positron","CartoDB.Positron",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["CartoDB.DarkMatter","CartoDB.DarkMatter","CartoDB.DarkMatter",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenStreetMap","OpenStreetMap","OpenStreetMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery","Esri.WorldImagery","Esri.WorldImagery",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenTopoMap","OpenTopoMap","OpenTopoMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"createMapPane","args":["polygon",420]},{"method":"addPolygons","args":[[[[{"lng":[-108.9433835067014,-109.552795410925,-109.5561778132309,-109.5592136207659,-109.5616057248418,-109.5631199634718,-109.5636080451151,-109.5630220901726,-109.5614193570183,-109.5589566749707,-109.0305488003595,-109.1173664007151,-109.1188985760194,-109.1193794062119,-109.1187617114884,-109.1171058486304,-109.1145738439324,-109.1114135563055,-109.1079344118346,-109.1044770863005,-108.1685824454908,-108.1655117014479,-108.1631107757973,-108.1616146749479,-107.7407271705574,-107.6391867894633,-107.6387644292095,-107.6394174425079,-107.6410818109817,-107.6435945637578,-107.6881864521305,-107.6912997341643,-108.9399837211961,-108.9433835067014],"lat":[35.10777328663495,35.11721422949334,35.11769586134165,35.11901266032363,35.12103576595605,35.12356718550593,35.12635915850417,35.12913839684497,35.13163283242744,35.13359825551703,35.72566186098808,36.92235378858925,36.92489065892773,36.92768350057297,36.93045894006379,36.93294527904355,36.93489909723548,36.9361290954288,36.93651483870987,36.93601855851567,36.71839235993613,36.71703920335757,36.71498829145951,36.7124404271318,35.98864294173935,35.34720623545293,35.34440969106944,35.34164307972429,35.33917719488259,35.33725337454909,35.30341916056209,35.30222441440467,35.10815677924445,35.10777328663495]}]],[[{"lng":[-107.305924318682,-107.3024708782463,-107.299398577562,-107.2970082095228,-107.2955337428468,-107.2951194261657,-107.2958056994812,-107.2975252800093,-107.3001097885957,-107.3033062526788,-107.7793951646955,-107.6669308438047,-107.664564748046,-107.122777582172,-107.1197714834059,-107.1174329927233,-107.1159910010004,-107.1155865836992,-107.1162592207542,-107.117942972974,-107.9635871716506,-107.9660707219092,-108.5278177507276,-108.5308815897636,-108.5342492020263,-108.5375910419093,-109.0154102328374,-109.0184114193041,-109.7948177078468,-109.7972125313335,-109.7987321413771,-110.0300522573082,-110.0305607946628,-110.0299841660097,-110.0283787120062,-110.025901524182,-109.8692587900611,-109.86614667214,-109.220245898488,-109.5635792698604,-109.566036260976,-109.9435480626664,-109.9466847242627,-109.9491603491597,-109.9507326010038,-109.9512475025939,-109.9506545365702,-109.9490116343967,-109.9464795484904,-109.7064361966094,-109.7032516282573,-109.6997384780986,-109.0713845306902,-108.8688542585342,-108.8653641027274,-108.8622409575583,-108.5388265462065,-107.305924318682],"lat":[37.20070238788016,37.20015356642254,37.1987778624497,37.19670998249779,37.19415239100038,37.19135547410546,37.18859301819322,37.18613540798682,37.18422316847808,37.18304343709727,36.09255213026282,35.98409910855371,35.9820397152595,35.5266301340767,35.52525355493997,35.52318491408031,35.52062674762579,35.51782949559237,35.51506697605032,35.5126095805585,34.65380039410076,34.65186820828207,34.29523709220928,34.29401836935271,34.29364498442202,34.29415348024676,34.40661768432123,34.40794703204788,35.00482783370042,35.00684638082235,35.00937501367565,35.94056536860839,35.94335545886459,35.94613678049059,35.94863706218725,35.9506115215709,36.03407289068009,36.03532403542888,36.58183784430391,37.28015861330124,37.28218242330345,37.53231680312631,37.53362505736085,37.5356411245177,37.53816770485597,37.54095751540453,37.54373748186818,37.5462354645238,37.5482069037252,37.71813806667475,37.71938324317215,37.71978565808125,37.70871885763092,37.69587651199053,37.69537228751902,37.69403565687448,37.48484358666187,37.20070238788016]}]],[[{"lng":[-107.9912845567882,-107.9878827129075,-107.9863904067553,-107.9859515070882,-107.934751020479,-107.5196973295036,-107.5182360438335,-107.5178166160064,-107.5184799935929,-107.5201611411467,-107.5570510688047,-107.8083070367124,-107.8089504015939,-107.9619476040057,-107.9635871716506,-107.9660707219092,-108.3256575986014,-108.3287304363676,-108.332105483944,-109.0022929927928,-109.0120603645079,-109.0154102328374,-109.0184114193041,-109.9015205588982,-109.9039137493893,-109.9054340035731,-109.9059324430692,-109.9053601761088,-109.8633998579061,-110.139159819751,-110.1415952668491,-110.1431456053887,-110.1436590089211,-110.1430851148712,-110.1414799952581,-110.1390007079922,-110.1358899468068,-109.6013899759165,-109.9553969741381,-109.9578686417065,-109.9594385756416,-109.9599530261367,-109.9593615207343,-109.9577218486282,-109.6473368811227,-109.6447930467105,-109.6416098941877,-109.6380990885554,-109.0690267354427,-108.8566958213405,-108.8532097772368,-108.8500904059595,-108.6995759881763,-108.4971510669192,-108.4947206605868,-107.9912845567882],"lat":[36.84499700969853,36.84111709598776,36.83856722239359,36.83577148954024,36.58245524888608,35.91306939905193,35.91051504539114,35.9077183625419,35.9049531140514,35.90248995934613,35.849882958195,34.97356037007695,34.970792232422,34.65627217865605,34.65380039410076,34.65186820828207,34.46616359171126,34.46495038784392,34.46458293724262,34.40515134351494,34.40612198270691,34.40661768432123,34.40794703204788,34.85294869003519,34.85496514863019,34.85749251754959,34.8602834330462,34.86306471127625,35.74815217491993,36.08889276111174,36.09090474596322,36.09342907548486,36.09621868542204,36.09900052091305,36.10150226056134,36.10347897923511,36.10473713733912,36.69727213124574,37.40380246386371,37.40581833101351,37.40834481361473,37.41113463810218,37.4139147287753,37.4164129338475,37.66079151947229,37.66275622760839,37.6639997759918,37.66440040145359,37.63167187196819,37.60957515867993,37.60907069354289,37.60773384017079,37.52141925301009,37.38660728223375,37.38456214338363,36.84499700969853]}]],[[{"lng":[-109.056776011309,-108.3017334880271,-108.2797265433041,-109.0409147711252,-109.056776011309],"lat":[37.0483342225742,37.03355829872128,37.64581792069022,37.66092254758372,37.0483342225742]}]]],null,"Region",{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"pane":"polygon","stroke":true,"color":["#001959","#3B6C55","#D29243","#000000"],"weight":3,"opacity":[0.9,0.9,0.9,0.9],"fill":true,"fillColor":["#001959","#3B6C55","#D29243","#000000"],"fillOpacity":[0,0,0,0],"smoothFactor":1,"noClip":false},["<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>1&emsp;<\/td><\/tr><tr><td>1<\/td><th>region&emsp;<\/th><td>E CRS (850–1040)&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>2&emsp;<\/td><\/tr><tr><td>1<\/td><th>region&emsp;<\/th><td>L CRS (1040–1150)&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>3&emsp;<\/td><\/tr><tr><td>1<\/td><th>region&emsp;<\/th><td>P CRS (1150–1300)&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>4&emsp;<\/td><\/tr><tr><td>1<\/td><th>region&emsp;<\/th><td>VEPIIN (850–1300)&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_MULTIPOLYGON&emsp;<\/td><\/tr><\/table><\/div>"],{"maxWidth":800,"minWidth":50,"autoPan":true,"keepInView":false,"closeButton":true,"closeOnClick":true,"className":""},["E CRS (850–1040)","L CRS (1040–1150)","P CRS (1150–1300)","VEPIIN (850–1300)"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},{"stroke":true,"weight":5,"opacity":0.9,"fillOpacity":0,"bringToFront":false,"sendToBack":false}]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":true,"updateWhenIdle":true,"position":"bottomleft"}]},{"method":"addHomeButton","args":[-110.1436590089211,34.29364498442202,-107.1155865836992,37.71978565808125,true,"Region","Zoom to Region","<strong> Region <\/strong>","bottomright"]},{"method":"addLayersControl","args":[["CartoDB.Positron","CartoDB.DarkMatter","OpenStreetMap","Esri.WorldImagery","OpenTopoMap"],"Region",{"collapsed":true,"autoZIndex":true,"position":"topleft"}]},{"method":"addLegend","args":[{"colors":["#001959","#3B6C55","#D29243","#000000"],"labels":["E CRS (850–1040)","L CRS (1040–1150)","P CRS (1150–1300)","VEPIIN (850–1300)"],"na_color":null,"na_label":"NA","opacity":1,"position":"topright","type":"factor","title":"Region","extra":null,"layerId":null,"className":"info legend","group":"Region"}]}],"limits":{"lat":[34.29364498442202,37.71978565808125],"lng":[-110.1436590089211,-107.1155865836992]},"fitBounds":[34.29364498442202,-110.1436590089211,37.71978565808125,-107.1155865836992,[]]},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\"position\":\"relative\",\"bottomleft\":\"0px\",\"background-color\":\"rgba(255, 255, 255, 0.7)\",\"box-shadow\":\"0 0 2px #bbb\",\"background-clip\":\"padding-box\",\"margin\":\"0\",\"padding-left\":\"5px\",\"padding-right\":\"5px\",\"color\":\"#333\",\"font-size\":\"9px\",\"font-family\":\"\\\"Helvetica Neue\\\", Arial, Helvetica, sans-serif\",\"text-align\":\"left\",\"z-index\":\"700\"});\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      if( strip !==null) strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null},{"code":"function(el, x, data) {\n  return (function(el,x,data){\n           var map = this;\n\n           map.on('keypress', function(e) {\n               console.log(e.originalEvent.code);\n               var key = e.originalEvent.code;\n               if (key === 'KeyE') {\n                   var bb = this.getBounds();\n                   var txt = JSON.stringify(bb);\n                   console.log(txt);\n\n                   setClipboardText('\\'' + txt + '\\'');\n               }\n           })\n        }).call(this.getMap(), el, x, data);\n}","data":null}]}}</script>
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-map-regions-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a)
</figcaption>
</figure>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: <strong>Extent of the Chaco Regional System during the Early CRS (AD 850-1039), Late CRS (1040-1149), and Post-CRS (1150-1300), with the VEPIIN area.</strong> Extrema identified for the Early and Late CRS. This map in the main manuscript was made in QGIS by Laura Brumbaugh.
</figcaption>
</figure>
</div>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get state boundaries from the US Census for mapping</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>states <span class="ot">&lt;-</span> </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  tigris<span class="sc">::</span><span class="fu">states</span>(<span class="at">cb =</span> <span class="cn">TRUE</span>,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">progress_bar =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(NAME <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Colorado"</span>,<span class="st">"Utah"</span>,<span class="st">"New Mexico"</span>,<span class="st">"Arizona"</span>))</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Retrieving data for the year 2024</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a plotting area around the "Chaco Basin"</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>chaco_basin <span class="ot">&lt;-</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_bbox</span>(<span class="fu">c</span>(<span class="at">xmin =</span> <span class="sc">-</span><span class="fl">110.35</span>,</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>                <span class="at">xmax =</span> <span class="sc">-</span><span class="fl">106.9</span>, </span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>                <span class="at">ymin =</span> <span class="fl">34.1</span>,</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>                <span class="at">ymax =</span> <span class="fl">37.8</span>), </span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>              <span class="at">crs =</span> <span class="st">"EPSG:4269"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_as_sfc</span>() <span class="sc">%&gt;%</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_bbox</span>()</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a faceting dataset that always includes VEPIIN</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>chaco_regions_facet <span class="ot">&lt;-</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>  chaco_regions <span class="sc">%&gt;%</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">lyr =</span> region) <span class="sc">%&gt;%</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(.,</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>                     dplyr<span class="sc">::</span><span class="fu">filter</span>(., lyr <span class="sc">==</span> <span class="st">"VEPIIN (850–1300)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>                       <span class="co"># THIS PIPE TYPE MATTERS</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>                       tidyr<span class="sc">::</span><span class="fu">uncount</span>(<span class="dv">3</span>) <span class="sc">|&gt;</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>                       dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">lyr =</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(., lyr <span class="sc">!=</span> <span class="st">"VEPIIN (850–1300)"</span>)<span class="sc">$</span>lyr))</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>  } <span class="sc">%&gt;%</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(lyr <span class="sc">!=</span> <span class="st">"VEPIIN (850–1300)"</span>)</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a><span class="co"># A function that makes a handsome faceted plot</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>plot_map_array <span class="ot">&lt;-</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(x, </span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>           filename,</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>           limits, </span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>           name,</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>           <span class="at">facet =</span> <span class="cn">TRUE</span>,</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>           ...){</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>    out <span class="ot">&lt;-</span> </span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>      (</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>          <span class="fu">geom_spatraster</span>(</span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> x,</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>            <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>          <span class="fu">facet_wrap</span>(<span class="sc">~</span>lyr) <span class="sc">+</span> </span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>          paletteer<span class="sc">::</span><span class="fu">scale_fill_paletteer_binned</span>(</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>            <span class="st">"scico::batlow"</span>,</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>            <span class="co"># dynamic = TRUE,</span></span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>            <span class="at">na.value =</span> <span class="st">"transparent"</span>,</span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>            <span class="at">n.breaks =</span> <span class="dv">10</span>,</span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>            <span class="at">show.limits =</span> <span class="cn">TRUE</span>,</span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>            <span class="at">limits =</span> limits,</span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>            <span class="at">name =</span> name,</span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>            ...) <span class="sc">+</span></span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>          <span class="fu">geom_sf</span>(<span class="at">data =</span> states,</span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>                  <span class="at">fill =</span> <span class="cn">NA</span>, </span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>          {</span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>(facet)</span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>              <span class="fu">geom_sf</span>(<span class="at">data =</span> chaco_regions_facet,</span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a>                      <span class="at">fill =</span> <span class="cn">NA</span>,</span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a>                      <span class="at">color =</span> <span class="st">"white"</span>)</span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a>          } <span class="sc">+</span></span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a>          <span class="fu">theme_void</span>() <span class="sc">+</span> </span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a>          <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"left"</span>,</span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a>                <span class="at">legend.justification =</span> <span class="fl">0.5</span>,</span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a>                <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a>                <span class="at">legend.title.position =</span> <span class="st">"left"</span>,</span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a>                <span class="at">legend.key.height =</span> <span class="fu">unit</span>(<span class="fl">0.15</span>, <span class="st">"npc"</span>)) <span class="sc">+</span></span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a>          <span class="fu">coord_sf</span>(<span class="at">crs =</span> <span class="st">"EPSG:4269"</span>,</span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a>                   <span class="at">xlim =</span> chaco_basin[<span class="fu">c</span>(<span class="st">"xmin"</span>, <span class="st">"xmax"</span>)],</span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ylim =</span> chaco_basin[<span class="fu">c</span>(<span class="st">"ymin"</span>, <span class="st">"ymax"</span>)],</span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a>                   <span class="at">expand =</span> <span class="cn">TRUE</span></span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(out)</span>
<span id="cb4-79"><a href="#cb4-79" aria-hidden="true" tabindex="-1"></a>  }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="dryland-maize-farming-niche" class="level2">
<h2 class="anchored" data-anchor-id="dryland-maize-farming-niche">Dryland Maize Farming Niche</h2>
<p>Here, we derive a dryland maize farming niche from paleoclimate reconstructions provided by the <em>Synthesizing Knowledge of Past Environments (SKOPE)</em> project. This code computes the Maize Farming Niche (MFN) for the U.S. Southwest by combining gridded paleoclimate reconstructions of precipitation and growing degree days (GDD), which we download from Amazon S3. We begin by defining output file paths and retrieving the relevant PaleoCAR raster data. We then generate a binary raster indicating areas suitable for maize cultivation—those where both precipitation and GDD exceed specified thresholds (e.g., GDD &gt; 1000). If this MFN raster does not already exist, we compute it and save it to disk. Next, we extract mean and standard deviation MFN values for each region in chaco_regions, summarizing the results in an Excel spreadsheet. Finally, we compute average MFN conditions for key archaeological periods (Early, Late, Post-Chaco, and VEPIIN) by averaging the relevant yearly layers in the raster stack.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>mfn_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data-derived"</span>,</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">paste0</span>(<span class="st">"maize_farming_niche_"</span>,ppt_threshold,<span class="st">".xlsx"</span>))</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>mfn_rast_path <span class="ot">&lt;-</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(<span class="st">"data-raw/maize_farming_niche_swus_paleocar_"</span>,ppt_threshold,<span class="st">".tif"</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Download PaleoCAR Maize niche data from Amazon S3.</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>mfn_sources <span class="ot">&lt;-</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">ppt_wateryear =</span> </span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>      <span class="st">"https://skope.s3.us-west-2.amazonaws.com/paleocar_v3/ppt_wateryear/prediction_scaled.tif"</span>,</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">gdd_maize_maysept =</span> </span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>      <span class="st">"https://skope.s3.us-west-2.amazonaws.com/paleocar_v3/gdd_maize_maysept/prediction_scaled.tif"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">download_files</span>(</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">urls =</span> .,</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">destfiles =</span> <span class="fu">file.path</span>(<span class="st">"data-raw"</span>, <span class="fu">paste0</span>(<span class="fu">names</span>(.), <span class="st">"_swus_paleocar.tif"</span>))</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>  } <span class="sc">%$%</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>  destfile <span class="sc">%&gt;%</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>  fs<span class="sc">::</span><span class="fu">path_rel</span>() <span class="sc">%&gt;%</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>  magrittr<span class="sc">::</span><span class="fu">set_names</span>(<span class="fu">c</span>(<span class="st">"ppt"</span>, <span class="st">"gdd"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.list</span>()</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Attempt 1 of 10</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; All files downloaded successfully.</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a><span class="do">## Calculate the MFN</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(mfn_rast_path)){</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>  ppt_niche <span class="ot">&lt;-</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">rast</span>(mfn_sources<span class="sc">$</span>ppt) <span class="sc">%T&gt;%</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">set.values</span>() <span class="sc">%&gt;%</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>    magrittr<span class="sc">::</span><span class="fu">is_weakly_greater_than</span>(ppt_threshold)</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>  gdd_niche <span class="ot">&lt;-</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">rast</span>(mfn_sources<span class="sc">$</span>gdd) <span class="sc">%T&gt;%</span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">set.values</span>() <span class="sc">%&gt;%</span></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>    magrittr<span class="sc">::</span><span class="fu">is_weakly_greater_than</span>(<span class="dv">1000</span>)</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>  niche <span class="ot">&lt;-</span> </span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>    (ppt_niche <span class="sc">&amp;</span> gdd_niche) <span class="sc">%T&gt;%</span></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">set.values</span>()</span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>  niche <span class="sc">%T&gt;%</span></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">writeRaster</span>(</span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>      <span class="at">filename =</span> mfn_rast_path,</span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>      <span class="at">datatype =</span> <span class="st">"INT2U"</span>,</span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>      <span class="at">overwrite =</span> <span class="cn">TRUE</span>,</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>      <span class="at">gdal =</span> <span class="fu">c</span>(<span class="st">"COMPRESS=ZSTD"</span>),</span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>      <span class="at">memfrac =</span> <span class="fl">0.9</span></span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(ppt_niche, gdd_niche, niche)</span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gc</span>(); <span class="fu">gc</span>()</span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a><span class="do">## Extract the data for each region and calculate the Maize Farming Niche</span></span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(mfn_path)){</span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>  niche <span class="ot">&lt;-</span></span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">rast</span>(</span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a>      mfn_rast_path</span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%T&gt;%</span></span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">set.values</span>()</span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a>  chaco_regions <span class="sc">%&gt;%</span></span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">niche =</span> </span>
<span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">list</span>(</span>
<span id="cb5-68"><a href="#cb5-68" aria-hidden="true" tabindex="-1"></a>                      niche <span class="sc">%&gt;%</span></span>
<span id="cb5-69"><a href="#cb5-69" aria-hidden="true" tabindex="-1"></a>                        terra<span class="sc">::</span><span class="fu">crop</span>(geometry, <span class="at">snap =</span> <span class="st">"out"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-70"><a href="#cb5-70" aria-hidden="true" tabindex="-1"></a>                        terra<span class="sc">::</span><span class="fu">mask</span>(terra<span class="sc">::</span><span class="fu">vect</span>(geometry)) <span class="sc">%&gt;%</span></span>
<span id="cb5-71"><a href="#cb5-71" aria-hidden="true" tabindex="-1"></a>                        terra<span class="sc">::</span><span class="fu">global</span>(<span class="fu">c</span>(<span class="st">"mean"</span>, <span class="st">"sd"</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-72"><a href="#cb5-72" aria-hidden="true" tabindex="-1"></a>                        tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">"year"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-73"><a href="#cb5-73" aria-hidden="true" tabindex="-1"></a>                        dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb5-74"><a href="#cb5-74" aria-hidden="true" tabindex="-1"></a>                          <span class="at">year =</span> <span class="fu">as.integer</span>(year)</span>
<span id="cb5-75"><a href="#cb5-75" aria-hidden="true" tabindex="-1"></a>                        )</span>
<span id="cb5-76"><a href="#cb5-76" aria-hidden="true" tabindex="-1"></a>                    )</span>
<span id="cb5-77"><a href="#cb5-77" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%$%</span></span>
<span id="cb5-78"><a href="#cb5-78" aria-hidden="true" tabindex="-1"></a>    magrittr<span class="sc">::</span><span class="fu">set_names</span>(niche, region) <span class="sc">%&gt;%</span></span>
<span id="cb5-79"><a href="#cb5-79" aria-hidden="true" tabindex="-1"></a>    purrr<span class="sc">::</span><span class="fu">map</span>(tibble<span class="sc">::</span>as_tibble) <span class="sc">%T&gt;%</span></span>
<span id="cb5-80"><a href="#cb5-80" aria-hidden="true" tabindex="-1"></a>    openxlsx<span class="sc">::</span><span class="fu">write.xlsx</span>(</span>
<span id="cb5-81"><a href="#cb5-81" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> mfn_path,</span>
<span id="cb5-82"><a href="#cb5-82" aria-hidden="true" tabindex="-1"></a>      <span class="at">asTable =</span> <span class="cn">TRUE</span>,</span>
<span id="cb5-83"><a href="#cb5-83" aria-hidden="true" tabindex="-1"></a>      <span class="at">colWidths =</span> <span class="st">"auto"</span></span>
<span id="cb5-84"><a href="#cb5-84" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-85"><a href="#cb5-85" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-86"><a href="#cb5-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-87"><a href="#cb5-87" aria-hidden="true" tabindex="-1"></a>maize_farming_niche <span class="ot">&lt;-</span></span>
<span id="cb5-88"><a href="#cb5-88" aria-hidden="true" tabindex="-1"></a>  mfn_path <span class="sc">%&gt;%</span></span>
<span id="cb5-89"><a href="#cb5-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_excel_all</span>()</span>
<span id="cb5-90"><a href="#cb5-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-91"><a href="#cb5-91" aria-hidden="true" tabindex="-1"></a>niche <span class="ot">&lt;-</span></span>
<span id="cb5-92"><a href="#cb5-92" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">rast</span>(</span>
<span id="cb5-93"><a href="#cb5-93" aria-hidden="true" tabindex="-1"></a>    mfn_rast_path</span>
<span id="cb5-94"><a href="#cb5-94" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%T&gt;%</span></span>
<span id="cb5-95"><a href="#cb5-95" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">set.values</span>()</span>
<span id="cb5-96"><a href="#cb5-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-97"><a href="#cb5-97" aria-hidden="true" tabindex="-1"></a>niche_periods <span class="ot">&lt;-</span> </span>
<span id="cb5-98"><a href="#cb5-98" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb5-99"><a href="#cb5-99" aria-hidden="true" tabindex="-1"></a>    <span class="st">"E CRS (850–1040)"</span> <span class="ot">=</span> <span class="dv">850</span><span class="sc">:</span><span class="dv">1040</span>, </span>
<span id="cb5-100"><a href="#cb5-100" aria-hidden="true" tabindex="-1"></a>    <span class="st">"L CRS (1040–1150)"</span> <span class="ot">=</span> <span class="dv">1040</span><span class="sc">:</span><span class="dv">1150</span>,</span>
<span id="cb5-101"><a href="#cb5-101" aria-hidden="true" tabindex="-1"></a>    <span class="st">"P CRS (1150–1300)"</span> <span class="ot">=</span> <span class="dv">1150</span><span class="sc">:</span><span class="dv">1300</span>,</span>
<span id="cb5-102"><a href="#cb5-102" aria-hidden="true" tabindex="-1"></a>    <span class="st">"VEPIIN (850–1300)"</span> <span class="ot">=</span> <span class="dv">850</span><span class="sc">:</span><span class="dv">1300</span></span>
<span id="cb5-103"><a href="#cb5-103" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb5-104"><a href="#cb5-104" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(</span>
<span id="cb5-105"><a href="#cb5-105" aria-hidden="true" tabindex="-1"></a>    stringr<span class="sc">::</span>str_pad,</span>
<span id="cb5-106"><a href="#cb5-106" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="dv">4</span>, </span>
<span id="cb5-107"><a href="#cb5-107" aria-hidden="true" tabindex="-1"></a>    <span class="at">pad =</span> <span class="st">"0"</span></span>
<span id="cb5-108"><a href="#cb5-108" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb5-109"><a href="#cb5-109" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(\(x){</span>
<span id="cb5-110"><a href="#cb5-110" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mean</span>(niche[[x]], <span class="at">na.rm=</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-111"><a href="#cb5-111" aria-hidden="true" tabindex="-1"></a>  }) <span class="sc">%&gt;%</span> </span>
<span id="cb5-112"><a href="#cb5-112" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">rast</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Here, we implement a sliding linear regressions smoothing model on the maize farming niche, and plot the resulting figure.</p>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>sliding_lm <span class="ot">&lt;-</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  maize_farming_niche <span class="sc">%&gt;%</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(<span class="at">.id =</span> <span class="st">"region"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.integer</span>(year)) <span class="sc">%&gt;%</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(region) <span class="sc">%&gt;%</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(region, year) <span class="sc">%&gt;%</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(year <span class="sc">%in%</span> <span class="dv">800</span><span class="sc">:</span><span class="dv">1350</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">model =</span> </span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>      slider<span class="sc">::</span><span class="fu">slide2</span>(</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">.x =</span> year,</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">.y =</span> mean,</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">.f =</span> <span class="sc">~</span><span class="fu">lm</span>(.y <span class="sc">~</span> .x),</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">.before =</span> <span class="dv">10</span>,</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">.after =</span> <span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">.complete =</span> <span class="cn">TRUE</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.null</span>(model)) <span class="sc">%&gt;%</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">fit =</span> </span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">predict</span>(model, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">.x =</span> year)),</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">se.fit =</span> </span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">predict</span>(model, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">.x =</span> year), <span class="at">se.fit =</span> <span class="cn">TRUE</span>)<span class="sc">$</span>se.fit,</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">lower =</span> fit <span class="sc">-</span> (<span class="fl">1.28</span> <span class="sc">*</span> se.fit),</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">upper =</span> fit <span class="sc">+</span> (<span class="fl">1.28</span> <span class="sc">*</span> se.fit)</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>()</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>sliding_lm <span class="sc">%&gt;%</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>    (region <span class="sc">==</span> <span class="st">"E CRS (850–1040)"</span> <span class="sc">&amp;</span> year <span class="sc">%in%</span> <span class="dv">850</span><span class="sc">:</span><span class="dv">1040</span>) <span class="sc">|</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>      (region <span class="sc">==</span> <span class="st">"L CRS (1040–1150)"</span> <span class="sc">&amp;</span> year <span class="sc">%in%</span> <span class="dv">1040</span><span class="sc">:</span><span class="dv">1150</span>) <span class="sc">|</span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>      (region <span class="sc">==</span> <span class="st">"P CRS (1150–1300)"</span> <span class="sc">&amp;</span> year <span class="sc">%in%</span> <span class="dv">1150</span><span class="sc">:</span><span class="dv">1300</span>) <span class="sc">|</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>      (region <span class="sc">==</span> <span class="st">"VEPIIN (850–1300)"</span> <span class="sc">&amp;</span> year <span class="sc">%in%</span> <span class="dv">850</span><span class="sc">:</span><span class="dv">1300</span>)</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> </span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>      <span class="fu">factor</span>(region, </span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>             <span class="at">levels =</span> </span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>               <span class="fu">c</span>(</span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"E CRS (850–1040)"</span>,</span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"L CRS (1040–1150)"</span>,</span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"P CRS (1150–1300)"</span>,</span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"VEPIIN (850–1300)"</span></span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>               ),</span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>             <span class="at">ordered =</span> <span class="cn">TRUE</span></span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>      )) <span class="sc">%&gt;%</span></span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> </span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>      <span class="fu">aes</span>(<span class="at">x =</span> year, </span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>          <span class="at">y =</span> fit, </span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>          <span class="at">ymin =</span> lower,</span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>          <span class="at">ymax =</span> upper,</span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>          <span class="at">color =</span> region,</span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>          <span class="at">fill =</span> region)</span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year A.D."</span>,</span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"P Cells in Dry-Farming Niche (smoothed)"</span>,</span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Region"</span>,</span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Region"</span></span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(</span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">850</span>, <span class="dv">1300</span>),</span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">850</span>, <span class="dv">1300</span>, <span class="dv">50</span>),</span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="dv">0</span>,<span class="dv">0</span>)</span>
<span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb6-74"><a href="#cb6-74" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb6-75"><a href="#cb6-75" aria-hidden="true" tabindex="-1"></a>    <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb6-76"><a href="#cb6-76" aria-hidden="true" tabindex="-1"></a>    <span class="at">oob =</span> scales<span class="sc">::</span>squish</span>
<span id="cb6-77"><a href="#cb6-77" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb6-78"><a href="#cb6-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb6-79"><a href="#cb6-79" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> chaco_region_colors) <span class="sc">+</span></span>
<span id="cb6-80"><a href="#cb6-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb6-81"><a href="#cb6-81" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> chaco_region_colors) <span class="sc">+</span></span>
<span id="cb6-82"><a href="#cb6-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="st">"figures/Figure_2_"</span>, ppt_threshold, <span class="st">".png"</span>), </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">device =</span> ragg<span class="sc">::</span>agg_png, </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">width =</span> fig_width, </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">height =</span> fig_height,</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">bg =</span> <span class="st">"white"</span>,</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">dpi =</span> <span class="dv">600</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figures/Figure_2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="3000"></p>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Average proportion of cells within the maize dry-farming niche through time for the four regions outlined in Figure 1. E CRS (etc.) indicates Early Chaco Regional System. The proportion of cells in the dry-farming niche is determined by tree-ring-based estimates of temperature and precipitation (Bocinsky and Kohler 2014). Cells with precipitation &gt;= 250mm and Growing Degree Days &gt;= 1000 are deemed within the niche. The point estimate plotted for each year is based on a linear regression of year on maize-niche proportion, using a moving window containing the previous 10 years. For example, the value plotted for AD 900 is the linear prediction using niche proportions from AD 890 to 899. The standard error for each regression is used to calculate 80% CIs around the point estimates, shown by the shaded areas. A simpler view of these data, by decadal means, is presented in Figure S1.
</figcaption>
</figure>
</div>
<p>In <a href="#suppfig-s1" class="quarto-xref">Figure S1</a>, we present a simplified version of <a href="#fig-2" class="quarto-xref">Figure&nbsp;2</a> using decadal means, as calculated here.</p>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>hopping_mean <span class="ot">&lt;-</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  maize_farming_niche <span class="sc">%&gt;%</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(<span class="at">.id =</span> <span class="st">"region"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.integer</span>(year)) <span class="sc">%&gt;%</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(region) <span class="sc">%&gt;%</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(region, year) <span class="sc">%&gt;%</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(year <span class="sc">%in%</span> <span class="dv">800</span><span class="sc">:</span><span class="dv">1350</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">fit =</span> </span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>      slider<span class="sc">::</span><span class="fu">slide_mean</span>(</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> mean,</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">before =</span> <span class="dv">10</span>,</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">after =</span> <span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">step =</span> <span class="dv">10</span>L,</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">complete =</span> <span class="cn">TRUE</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(fit))</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>hopping_mean <span class="sc">%&gt;%</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>    (region <span class="sc">==</span> <span class="st">"E CRS (850–1040)"</span> <span class="sc">&amp;</span> year <span class="sc">%in%</span> <span class="dv">850</span><span class="sc">:</span><span class="dv">1040</span>) <span class="sc">|</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>      (region <span class="sc">==</span> <span class="st">"L CRS (1040–1150)"</span> <span class="sc">&amp;</span> year <span class="sc">%in%</span> <span class="dv">1040</span><span class="sc">:</span><span class="dv">1150</span>) <span class="sc">|</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>      (region <span class="sc">==</span> <span class="st">"P CRS (1150–1300)"</span> <span class="sc">&amp;</span> year <span class="sc">%in%</span> <span class="dv">1150</span><span class="sc">:</span><span class="dv">1300</span>) <span class="sc">|</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>      (region <span class="sc">==</span> <span class="st">"VEPIIN (850–1300)"</span> <span class="sc">&amp;</span> year <span class="sc">%in%</span> <span class="dv">850</span><span class="sc">:</span><span class="dv">1300</span>)</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> </span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>      <span class="fu">factor</span>(region, </span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>             <span class="at">levels =</span> </span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>               <span class="fu">c</span>(</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"E CRS (850–1040)"</span>,</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"L CRS (1040–1150)"</span>,</span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"P CRS (1150–1300)"</span>,</span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"VEPIIN (850–1300)"</span></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>               ),</span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>             <span class="at">ordered =</span> <span class="cn">TRUE</span></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>      )) <span class="sc">%&gt;%</span></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> </span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>      <span class="fu">aes</span>(<span class="at">x =</span> year, </span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>          <span class="at">y =</span> fit, </span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>          <span class="co"># ymin = lower,</span></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>          <span class="co"># ymax = upper,</span></span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>          <span class="at">color =</span> region,</span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>          <span class="at">fill =</span> region)</span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_ribbon(alpha = 0.3, color = NA) +</span></span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year A.D."</span>,</span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"P Cells in Dry-Farming Niche (smoothed)"</span>,</span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Region"</span>,</span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Region"</span></span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(</span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">850</span>, <span class="dv">1300</span>),</span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">850</span>, <span class="dv">1300</span>, <span class="dv">50</span>),</span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="dv">0</span>,<span class="dv">0</span>)</span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a>    <span class="at">oob =</span> scales<span class="sc">::</span>squish</span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> chaco_region_colors) <span class="sc">+</span></span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="st">"figures/Figure_s1_"</span>, ppt_threshold, <span class="st">".png"</span>), </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">device =</span> ragg<span class="sc">::</span>agg_png, </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">width =</span> fig_width, </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">height =</span> fig_height,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">bg =</span> <span class="st">"white"</span>,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">dpi =</span> <span class="dv">600</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="suppfig-s1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-suppfig figure">
<div aria-describedby="suppfig-s1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figures/Figure_s1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="3000"></p>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-suppfig" id="suppfig-s1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure S1: Average proportion of cells within the maize dry-farming niche by decade for the four regions outlined in Figure 1. The proportion of cells in the dry-farming niche is determined by tree-ring-based estimates of temperature and precipitation (Bocinsky and Kohler 2014). Cells with precipitation &gt;= 300mm and Growing Degree Days &gt;= 1000 are deemed within the niche. Each vertex represents the mean proportion of the study area within the maize niche for the preceding 10 years (i.e., the vertex at 860 represents the years 850-859). This represents the most temporally relevant knowledge a Pueblo farmer in that year would have about recent agricultural conditions.This is a simplified view of the more detailed maize niche data presented in the main paper, Figure 2.
</figcaption>
</figure>
</div>
<p>The Maize Farming Niche may be visualized as the proportion of years within a given period that meet the niche thresholds (here, 250 mm of water year precipitation and 1000 growing degree days).</p>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_map_array</span>(</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> niche_periods[[<span class="fu">c</span>(<span class="st">"E CRS (850–1040)"</span>,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"L CRS (1040–1150)"</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"P CRS (1150–1300)"</span>)]] <span class="sc">%&gt;%</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>      terra<span class="sc">::</span><span class="fu">crop</span>(chaco_basin,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">touches =</span> <span class="cn">FALSE</span>), </span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), </span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">P Years in Dry-Farming Niche"</span>,</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> scales<span class="sc">::</span>percent</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%T&gt;%</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="at">plot =</span> .,</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">filename =</span> <span class="fu">paste0</span>(<span class="st">"figures/Figure_s2_"</span>, ppt_threshold, <span class="st">".png"</span>),</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">device =</span> ragg<span class="sc">::</span>agg_png,</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">width =</span> fig_width, </span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">height =</span> fig_height,</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">bg =</span> <span class="st">"white"</span>,</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">dpi =</span> <span class="dv">600</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="suppfig-s2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-suppfig figure">
<div aria-describedby="suppfig-s2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figures/Figure_s2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="3000"></p>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-suppfig" id="suppfig-s2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure S2: Percent of years in the maize dry-farming niche across Chacoan regions during key cultural periods.
</figcaption>
</figure>
</div>
</section>
<section id="modeling-pre-european-net-primary-productivity" class="level2">
<h2 class="anchored" data-anchor-id="modeling-pre-european-net-primary-productivity">Modeling pre-European Net Primary Productivity</h2>
<p>To model pre-European Net Primary Productivity (NPP), we estimated potential landscape productivity in the absence of modern irrigation and disturbance, establishing a baseline for past agricultural suitability. We used MODIS 250m annual NPP data for the years 2002, 2007, 2012, and 2017 (Rollins 2009), along with MIRAD irrigated lands data (Pervez and Brown 2010), Landfire datasets (Biophysical Settings, Existing Vegetation Types, Historical Disturbance; (Nelson et al.&nbsp;2013; Rollins 2009), and PRISM 800m elevation data. We reprojected and aligned all datasets to a common spatial template based on the 800m PRISM dataset. For model training, we retained irrigated and disturbed pixels, but we excluded them during prediction to simulate pre-European conditions.</p>
<p>This section of the code prepares the environmental raster datasets at a common resolution and extent. Specifically, we resample, reclassify, and align data on productivity, irrigation, vegetation, disturbance, and elevation to a shared spatial template.</p>
<section id="data-preparation" class="level3">
<h3 class="anchored" data-anchor-id="data-preparation">Data preparation</h3>
<section id="establish-a-template-raster" class="level4">
<h4 class="anchored" data-anchor-id="establish-a-template-raster">1. Establish a Template Raster</h4>
<p>We create a single-layer raster template based on the Maize Farming Niche data to use as a consistent spatial reference for projection and alignment.</p>
</section>
<section id="modis-net-primary-productivity-npp" class="level4">
<h4 class="anchored" data-anchor-id="modis-net-primary-productivity-npp">2. MODIS Net Primary Productivity (NPP)</h4>
<ul>
<li>We download 250-meter MODIS NPP rasters for selected years (2002, 2007, 2012, 2017) from the <a href="http://files.ntsg.umt.edu/data/NTSG_Products/MOD17/">Numerical Terradynamic Simulation Group (NTSG)</a>.</li>
<li>We extract the <code>annualNPP</code> layer, project it to the template grid using bilinear interpolation, and save the output as a compressed raster stack.</li>
</ul>
</section>
<section id="irrigated-lands-mirad" class="level4">
<h4 class="anchored" data-anchor-id="irrigated-lands-mirad">3. Irrigated Lands (MIRAD)</h4>
<ul>
<li>We query and download MIRAD-derived irrigated lands data from the USGS ScienceBase repository (<a href="https://doi.org/10.5066/P9NA3EO8">DOI:10.5066/P9NA3EO8</a>).</li>
<li>We load the relevant 250m rasters, project them to our template using <code>max</code> resampling (preserving irrigated presence), and save the result as a binary raster.</li>
</ul>
</section>
<section id="landfire-vegetation-and-disturbance-layers" class="level4">
<h4 class="anchored" data-anchor-id="landfire-vegetation-and-disturbance-layers">4. LANDFIRE Vegetation and Disturbance Layers</h4>
<ul>
<li>We download three datasets from LANDFIRE:
<ul>
<li><strong>Biophysical Settings (BPS)</strong>: <a href="https://www.landfire.gov/data-downloads/US_220/LF2020_BPS_220_CONUS.zip">LF2020 BPS</a></li>
<li><strong>Historical Disturbance (HDist)</strong>: <a href="https://www.landfire.gov/data-downloads/US_Disturbance/LF2023_HDist_240_CONUS.zip">LF2023 HDist</a></li>
<li><strong>Existing Vegetation Types (EVT)</strong>: <a href="https://www.landfire.gov/data-downloads/US_240/LF2023_EVT_240_CONUS.zip">LF2023 EVT</a></li>
</ul></li>
<li>For each dataset:
<ul>
<li>We unzip the file, extract the raster and its corresponding classification CSV.</li>
<li>We project it to our template using <code>mode</code> resampling (preserving dominant class).</li>
<li>We recategorize factor levels to consolidate similar vegetation types or correct naming inconsistencies.</li>
</ul></li>
<li>We then assemble the BPS, EVT, and HDist layers into a single multi-layer raster object.</li>
</ul>
</section>
<section id="prism-elevation" class="level4">
<h4 class="anchored" data-anchor-id="prism-elevation">5. PRISM Elevation</h4>
<ul>
<li>We download the 800-meter DEM from the <a href="https://prism.oregonstate.edu">PRISM Climate Group</a> via a virtual file system call (<code>/vsicurl</code>).</li>
<li>We crop it to the template extent and save the result for elevation analysis.</li>
</ul>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>template <span class="ot">&lt;-</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">rast</span>(niche_periods) <span class="sc">%&gt;%</span> </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">rast</span>(<span class="at">nlyr =</span> <span class="dv">1</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="do">## MODIS NPP (250m)</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(<span class="st">"data-derived/modis_npp_swus_paleocar.tif"</span>)){</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  get_npp <span class="ot">&lt;-</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">function</span>(<span class="at">years =</span> <span class="fu">c</span>(<span class="dv">2002</span>, <span class="dv">2007</span>, <span class="dv">2012</span>, <span class="dv">2017</span>)){</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>      modis_npp_urls <span class="ot">&lt;-</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>        <span class="fu">paste0</span>(<span class="st">"http://files.ntsg.umt.edu/data/NTSG_Products/MOD17/MODIS_250/modis-250-npp/modis-250-npp-"</span>,years,<span class="st">".tif"</span>)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>      destfiles <span class="ot">&lt;-</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>        <span class="fu">file.path</span>(<span class="st">"data-raw"</span>,</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">basename</span>(modis_npp_urls))</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">download_files</span>(</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">urls =</span> modis_npp_urls,</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">destfiles =</span> destfiles</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">%$%</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>        destfile <span class="sc">%&gt;%</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>        purrr<span class="sc">::</span><span class="fu">map</span>(terra<span class="sc">::</span>rast) <span class="sc">%&gt;%</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>        purrr<span class="sc">::</span><span class="fu">map</span>(\(x) x<span class="sc">$</span>annualNPP) <span class="sc">%&gt;%</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>        terra<span class="sc">::</span><span class="fu">rast</span>() <span class="sc">%&gt;%</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>        magrittr<span class="sc">::</span><span class="fu">set_names</span>(<span class="fu">paste0</span>(years, <span class="st">" 250m MODIS NPP"</span>))</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>  modis_npp <span class="ot">&lt;-</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">get_npp</span>() <span class="sc">%&gt;%</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">project</span>(template,</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>                   <span class="at">method =</span> <span class="st">"bilinear"</span>,</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>                   <span class="at">filename =</span> <span class="st">"data-derived/modis_npp_swus_paleocar.tif"</span>,</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>                   <span class="at">datatype =</span> <span class="st">"INT2U"</span>,</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>                   <span class="at">overwrite =</span> <span class="cn">TRUE</span>,</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>                   <span class="at">gdal =</span> <span class="fu">c</span>(<span class="st">"COMPRESS=ZSTD"</span>),</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>                   <span class="at">memfrac =</span> <span class="fl">0.9</span>)</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>modis_npp <span class="ot">&lt;-</span> </span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">rast</span>(<span class="st">"data-derived/modis_npp_swus_paleocar.tif"</span>)</span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a><span class="do">## Irrigated Lands</span></span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(<span class="st">"data-derived/mirad_irrlands_swus_paleocar.tif"</span>)){</span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>  get_scibase <span class="ot">&lt;-</span></span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">function</span>(uri, filename){</span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>      file <span class="ot">&lt;-</span></span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>        stringr<span class="sc">::</span><span class="fu">str_replace</span>(filename, <span class="st">".zip"</span>, <span class="st">".tif"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>        stringr<span class="sc">::</span><span class="fu">str_replace</span>(<span class="st">"m_"</span>,<span class="st">"_"</span>)</span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(filename)) {</span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a>        uri <span class="sc">%&gt;%</span></span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a>          <span class="fu">download.file</span>(<span class="at">destfile =</span> <span class="fu">file.path</span>(<span class="st">"data-raw"</span>, filename))</span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a>      <span class="fu">file.path</span>(<span class="st">"/vsizip"</span>, </span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a>                <span class="st">"data-raw"</span>,</span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a>                filename,</span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a>                stringr<span class="sc">::</span><span class="fu">str_remove</span>(filename, <span class="st">".zip"</span>),</span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a>                file) <span class="sc">%&gt;%</span></span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a>        terra<span class="sc">::</span><span class="fu">rast</span>()</span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a>  mirad_irrlands <span class="ot">&lt;-</span></span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true" tabindex="-1"></a>    <span class="fu">query_sb_doi</span>(<span class="st">"10.5066/P9NA3EO8"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-65"><a href="#cb11-65" aria-hidden="true" tabindex="-1"></a>    purrr<span class="sc">::</span><span class="fu">pluck</span>(<span class="dv">1</span>, <span class="st">"files"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-66"><a href="#cb11-66" aria-hidden="true" tabindex="-1"></a>    purrr<span class="sc">::</span><span class="fu">map</span>(\(x)x[<span class="fu">c</span>(<span class="st">"title"</span>, <span class="st">"name"</span>, <span class="st">"downloadUri"</span>)]) <span class="sc">%&gt;%</span></span>
<span id="cb11-67"><a href="#cb11-67" aria-hidden="true" tabindex="-1"></a>    purrr<span class="sc">::</span><span class="fu">list_transpose</span>(<span class="at">simplify =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-68"><a href="#cb11-68" aria-hidden="true" tabindex="-1"></a>    tibble<span class="sc">::</span><span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb11-69"><a href="#cb11-69" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(stringr<span class="sc">::</span><span class="fu">str_detect</span>(title, <span class="st">"250m"</span>),</span>
<span id="cb11-70"><a href="#cb11-70" aria-hidden="true" tabindex="-1"></a>                  stringr<span class="sc">::</span><span class="fu">str_detect</span>(title, <span class="st">"All"</span>, <span class="at">negate =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb11-71"><a href="#cb11-71" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb11-72"><a href="#cb11-72" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb11-73"><a href="#cb11-73" aria-hidden="true" tabindex="-1"></a>      <span class="at">rast =</span> <span class="fu">list</span>(</span>
<span id="cb11-74"><a href="#cb11-74" aria-hidden="true" tabindex="-1"></a>        <span class="fu">get_scibase</span>(</span>
<span id="cb11-75"><a href="#cb11-75" aria-hidden="true" tabindex="-1"></a>          <span class="at">uri =</span> downloadUri,</span>
<span id="cb11-76"><a href="#cb11-76" aria-hidden="true" tabindex="-1"></a>          <span class="at">filename =</span> name</span>
<span id="cb11-77"><a href="#cb11-77" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb11-78"><a href="#cb11-78" aria-hidden="true" tabindex="-1"></a>      )) <span class="sc">%$%</span></span>
<span id="cb11-79"><a href="#cb11-79" aria-hidden="true" tabindex="-1"></a>    {magrittr<span class="sc">::</span><span class="fu">set_names</span>(rast, title)} <span class="sc">%&gt;%</span></span>
<span id="cb11-80"><a href="#cb11-80" aria-hidden="true" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">rast</span>() <span class="sc">%&gt;%</span></span>
<span id="cb11-81"><a href="#cb11-81" aria-hidden="true" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">project</span>(template,</span>
<span id="cb11-82"><a href="#cb11-82" aria-hidden="true" tabindex="-1"></a>                   <span class="at">method =</span> <span class="st">"max"</span>,</span>
<span id="cb11-83"><a href="#cb11-83" aria-hidden="true" tabindex="-1"></a>                   <span class="at">filename =</span> <span class="st">"data-derived/mirad_irrlands_swus_paleocar.tif"</span>,</span>
<span id="cb11-84"><a href="#cb11-84" aria-hidden="true" tabindex="-1"></a>                   <span class="at">datatype =</span> <span class="st">"INT1U"</span>,</span>
<span id="cb11-85"><a href="#cb11-85" aria-hidden="true" tabindex="-1"></a>                   <span class="at">overwrite =</span> <span class="cn">TRUE</span>,</span>
<span id="cb11-86"><a href="#cb11-86" aria-hidden="true" tabindex="-1"></a>                   <span class="at">gdal =</span> <span class="fu">c</span>(<span class="st">"COMPRESS=ZSTD"</span>, <span class="st">"NBITS=1"</span>),</span>
<span id="cb11-87"><a href="#cb11-87" aria-hidden="true" tabindex="-1"></a>                   <span class="at">memfrac =</span> <span class="fl">0.9</span>)</span>
<span id="cb11-88"><a href="#cb11-88" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-89"><a href="#cb11-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-90"><a href="#cb11-90" aria-hidden="true" tabindex="-1"></a>mirad_irrlands <span class="ot">&lt;-</span> </span>
<span id="cb11-91"><a href="#cb11-91" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">rast</span>(<span class="st">"data-derived/mirad_irrlands_swus_paleocar.tif"</span>)</span>
<span id="cb11-92"><a href="#cb11-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-93"><a href="#cb11-93" aria-hidden="true" tabindex="-1"></a><span class="co"># Landfire BPS, Historical Disturbance, and Existing Vegetation Types</span></span>
<span id="cb11-94"><a href="#cb11-94" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">c</span>(</span>
<span id="cb11-95"><a href="#cb11-95" aria-hidden="true" tabindex="-1"></a>  <span class="at">bps =</span> <span class="st">"data-derived/landfire_bps_swus_paleocar.tif"</span>,</span>
<span id="cb11-96"><a href="#cb11-96" aria-hidden="true" tabindex="-1"></a>  <span class="at">disturbance =</span> <span class="st">"data-derived/landfire_disturbance_swus_paleocar.tif"</span>,</span>
<span id="cb11-97"><a href="#cb11-97" aria-hidden="true" tabindex="-1"></a>  <span class="at">evt =</span> <span class="st">"data-derived/landfire_evt_swus_paleocar.tif"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-98"><a href="#cb11-98" aria-hidden="true" tabindex="-1"></a>  <span class="fu">file.exists</span>() <span class="sc">%&gt;%</span></span>
<span id="cb11-99"><a href="#cb11-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">all</span>() <span class="sc">%&gt;%</span></span>
<span id="cb11-100"><a href="#cb11-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">not</span>()){</span>
<span id="cb11-101"><a href="#cb11-101" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-102"><a href="#cb11-102" aria-hidden="true" tabindex="-1"></a>  read_and_write_landfire <span class="ot">&lt;-</span></span>
<span id="cb11-103"><a href="#cb11-103" aria-hidden="true" tabindex="-1"></a>    <span class="cf">function</span>(raster, levels, outfile){</span>
<span id="cb11-104"><a href="#cb11-104" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(outfile)){</span>
<span id="cb11-105"><a href="#cb11-105" aria-hidden="true" tabindex="-1"></a>        out <span class="ot">&lt;-</span></span>
<span id="cb11-106"><a href="#cb11-106" aria-hidden="true" tabindex="-1"></a>          terra<span class="sc">::</span><span class="fu">rast</span>(raster) <span class="sc">%&gt;%</span></span>
<span id="cb11-107"><a href="#cb11-107" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">levels&lt;-</span><span class="st">`</span>(</span>
<span id="cb11-108"><a href="#cb11-108" aria-hidden="true" tabindex="-1"></a>            sf<span class="sc">::</span><span class="fu">read_sf</span>(levels) <span class="sc">%&gt;%</span></span>
<span id="cb11-109"><a href="#cb11-109" aria-hidden="true" tabindex="-1"></a>              readr<span class="sc">::</span><span class="fu">type_convert</span>()</span>
<span id="cb11-110"><a href="#cb11-110" aria-hidden="true" tabindex="-1"></a>          ) <span class="sc">%&gt;%</span></span>
<span id="cb11-111"><a href="#cb11-111" aria-hidden="true" tabindex="-1"></a>          terra<span class="sc">::</span><span class="fu">project</span>(</span>
<span id="cb11-112"><a href="#cb11-112" aria-hidden="true" tabindex="-1"></a>            template,</span>
<span id="cb11-113"><a href="#cb11-113" aria-hidden="true" tabindex="-1"></a>            <span class="at">method =</span> <span class="st">"mode"</span>,</span>
<span id="cb11-114"><a href="#cb11-114" aria-hidden="true" tabindex="-1"></a>            <span class="at">filename =</span> outfile,</span>
<span id="cb11-115"><a href="#cb11-115" aria-hidden="true" tabindex="-1"></a>            <span class="at">datatype =</span> <span class="st">"INT4U"</span>,</span>
<span id="cb11-116"><a href="#cb11-116" aria-hidden="true" tabindex="-1"></a>            <span class="at">overwrite =</span> <span class="cn">TRUE</span>,</span>
<span id="cb11-117"><a href="#cb11-117" aria-hidden="true" tabindex="-1"></a>            <span class="at">gdal =</span> <span class="fu">c</span>(<span class="st">"COMPRESS=ZSTD"</span>),</span>
<span id="cb11-118"><a href="#cb11-118" aria-hidden="true" tabindex="-1"></a>            <span class="at">memfrac =</span> <span class="fl">0.9</span></span>
<span id="cb11-119"><a href="#cb11-119" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb11-120"><a href="#cb11-120" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb11-121"><a href="#cb11-121" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(outfile)</span>
<span id="cb11-122"><a href="#cb11-122" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-123"><a href="#cb11-123" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-124"><a href="#cb11-124" aria-hidden="true" tabindex="-1"></a>  landfire <span class="ot">&lt;-</span></span>
<span id="cb11-125"><a href="#cb11-125" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(</span>
<span id="cb11-126"><a href="#cb11-126" aria-hidden="true" tabindex="-1"></a>      <span class="at">bps =</span> <span class="st">"https://www.landfire.gov/data-downloads/US_220/LF2020_BPS_220_CONUS.zip"</span>,</span>
<span id="cb11-127"><a href="#cb11-127" aria-hidden="true" tabindex="-1"></a>      <span class="at">disturbance =</span> <span class="st">"https://www.landfire.gov/data-downloads/US_Disturbance/LF2023_HDist_240_CONUS.zip"</span>,</span>
<span id="cb11-128"><a href="#cb11-128" aria-hidden="true" tabindex="-1"></a>      <span class="at">evt =</span> <span class="st">"https://www.landfire.gov/data-downloads/US_240/LF2023_EVT_240_CONUS.zip"</span></span>
<span id="cb11-129"><a href="#cb11-129" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb11-130"><a href="#cb11-130" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb11-131"><a href="#cb11-131" aria-hidden="true" tabindex="-1"></a>      tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb11-132"><a href="#cb11-132" aria-hidden="true" tabindex="-1"></a>        <span class="at">dataset =</span> <span class="fu">names</span>(.),</span>
<span id="cb11-133"><a href="#cb11-133" aria-hidden="true" tabindex="-1"></a>        <span class="at">downloads =</span> .</span>
<span id="cb11-134"><a href="#cb11-134" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb11-135"><a href="#cb11-135" aria-hidden="true" tabindex="-1"></a>    } <span class="sc">%&gt;%</span></span>
<span id="cb11-136"><a href="#cb11-136" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb11-137"><a href="#cb11-137" aria-hidden="true" tabindex="-1"></a>      <span class="at">destfiles =</span> <span class="fu">file.path</span>(<span class="st">"data-raw"</span>, <span class="fu">basename</span>(downloads)),</span>
<span id="cb11-138"><a href="#cb11-138" aria-hidden="true" tabindex="-1"></a>      <span class="at">destfiles =</span> </span>
<span id="cb11-139"><a href="#cb11-139" aria-hidden="true" tabindex="-1"></a>        <span class="fu">download_files</span>(</span>
<span id="cb11-140"><a href="#cb11-140" aria-hidden="true" tabindex="-1"></a>          <span class="at">urls =</span></span>
<span id="cb11-141"><a href="#cb11-141" aria-hidden="true" tabindex="-1"></a>            downloads,</span>
<span id="cb11-142"><a href="#cb11-142" aria-hidden="true" tabindex="-1"></a>          <span class="at">destfiles =</span> </span>
<span id="cb11-143"><a href="#cb11-143" aria-hidden="true" tabindex="-1"></a>            destfiles</span>
<span id="cb11-144"><a href="#cb11-144" aria-hidden="true" tabindex="-1"></a>        )<span class="sc">$</span>destfile</span>
<span id="cb11-145"><a href="#cb11-145" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb11-146"><a href="#cb11-146" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb11-147"><a href="#cb11-147" aria-hidden="true" tabindex="-1"></a>      <span class="at">rastfile =</span> </span>
<span id="cb11-148"><a href="#cb11-148" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">case_match</span>(</span>
<span id="cb11-149"><a href="#cb11-149" aria-hidden="true" tabindex="-1"></a>          dataset,</span>
<span id="cb11-150"><a href="#cb11-150" aria-hidden="true" tabindex="-1"></a>          <span class="st">"bps"</span> <span class="sc">~</span> </span>
<span id="cb11-151"><a href="#cb11-151" aria-hidden="true" tabindex="-1"></a>            <span class="fu">basename</span>(destfiles) <span class="sc">%&gt;%</span></span>
<span id="cb11-152"><a href="#cb11-152" aria-hidden="true" tabindex="-1"></a>            stringr<span class="sc">::</span><span class="fu">str_replace</span>(<span class="st">"_CONUS.zip"</span>, <span class="st">".tif"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-153"><a href="#cb11-153" aria-hidden="true" tabindex="-1"></a>            stringr<span class="sc">::</span><span class="fu">str_replace</span>(<span class="st">"LF2020"</span>, <span class="st">"LC20"</span>),</span>
<span id="cb11-154"><a href="#cb11-154" aria-hidden="true" tabindex="-1"></a>          <span class="st">"disturbance"</span> <span class="sc">~</span> </span>
<span id="cb11-155"><a href="#cb11-155" aria-hidden="true" tabindex="-1"></a>            <span class="fu">basename</span>(destfiles) <span class="sc">%&gt;%</span></span>
<span id="cb11-156"><a href="#cb11-156" aria-hidden="true" tabindex="-1"></a>            stringr<span class="sc">::</span><span class="fu">str_replace</span>(<span class="st">"_CONUS.zip"</span>, <span class="st">".tif"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-157"><a href="#cb11-157" aria-hidden="true" tabindex="-1"></a>            stringr<span class="sc">::</span><span class="fu">str_replace</span>(<span class="st">"LF20"</span>, <span class="st">"LC"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-158"><a href="#cb11-158" aria-hidden="true" tabindex="-1"></a>            stringr<span class="sc">::</span><span class="fu">str_replace</span>(<span class="st">"HDist"</span>, <span class="st">"HDst"</span>),</span>
<span id="cb11-159"><a href="#cb11-159" aria-hidden="true" tabindex="-1"></a>          <span class="st">"evt"</span> <span class="sc">~</span> </span>
<span id="cb11-160"><a href="#cb11-160" aria-hidden="true" tabindex="-1"></a>            <span class="fu">basename</span>(destfiles) <span class="sc">%&gt;%</span></span>
<span id="cb11-161"><a href="#cb11-161" aria-hidden="true" tabindex="-1"></a>            stringr<span class="sc">::</span><span class="fu">str_replace</span>(<span class="st">"_CONUS.zip"</span>, <span class="st">".tif"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-162"><a href="#cb11-162" aria-hidden="true" tabindex="-1"></a>            stringr<span class="sc">::</span><span class="fu">str_replace</span>(<span class="st">"LF20"</span>, <span class="st">"LC"</span>)</span>
<span id="cb11-163"><a href="#cb11-163" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span></span>
<span id="cb11-164"><a href="#cb11-164" aria-hidden="true" tabindex="-1"></a>        <span class="fu">file.path</span>(<span class="st">"/vsizip"</span>, destfiles,</span>
<span id="cb11-165"><a href="#cb11-165" aria-hidden="true" tabindex="-1"></a>                  stringr<span class="sc">::</span><span class="fu">str_remove</span>(<span class="fu">basename</span>(destfiles), <span class="st">".zip"</span>),</span>
<span id="cb11-166"><a href="#cb11-166" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Tif"</span>,</span>
<span id="cb11-167"><a href="#cb11-167" aria-hidden="true" tabindex="-1"></a>                  .),</span>
<span id="cb11-168"><a href="#cb11-168" aria-hidden="true" tabindex="-1"></a>      <span class="at">levelsfile =</span></span>
<span id="cb11-169"><a href="#cb11-169" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">case_match</span>(</span>
<span id="cb11-170"><a href="#cb11-170" aria-hidden="true" tabindex="-1"></a>          dataset,</span>
<span id="cb11-171"><a href="#cb11-171" aria-hidden="true" tabindex="-1"></a>          <span class="st">"bps"</span> <span class="sc">~</span></span>
<span id="cb11-172"><a href="#cb11-172" aria-hidden="true" tabindex="-1"></a>            rastfile <span class="sc">%&gt;%</span></span>
<span id="cb11-173"><a href="#cb11-173" aria-hidden="true" tabindex="-1"></a>            stringr<span class="sc">::</span><span class="fu">str_replace</span>(<span class="st">"Tif"</span>, <span class="st">"CSV_Data"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-174"><a href="#cb11-174" aria-hidden="true" tabindex="-1"></a>            stringr<span class="sc">::</span><span class="fu">str_replace</span>(<span class="st">".tif"</span>, <span class="st">".csv"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-175"><a href="#cb11-175" aria-hidden="true" tabindex="-1"></a>            stringr<span class="sc">::</span><span class="fu">str_replace</span>(<span class="st">"LC20"</span>, <span class="st">"LF20"</span>),</span>
<span id="cb11-176"><a href="#cb11-176" aria-hidden="true" tabindex="-1"></a>          <span class="st">"disturbance"</span> <span class="sc">~</span> </span>
<span id="cb11-177"><a href="#cb11-177" aria-hidden="true" tabindex="-1"></a>            rastfile <span class="sc">%&gt;%</span></span>
<span id="cb11-178"><a href="#cb11-178" aria-hidden="true" tabindex="-1"></a>            stringr<span class="sc">::</span><span class="fu">str_replace</span>(<span class="st">"Tif"</span>, <span class="st">"CSV_Data"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-179"><a href="#cb11-179" aria-hidden="true" tabindex="-1"></a>            stringr<span class="sc">::</span><span class="fu">str_replace</span>(<span class="st">".tif"</span>, <span class="st">".csv"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-180"><a href="#cb11-180" aria-hidden="true" tabindex="-1"></a>            stringr<span class="sc">::</span><span class="fu">str_replace</span>(<span class="st">"LC23"</span>, <span class="st">"LF23"</span>),</span>
<span id="cb11-181"><a href="#cb11-181" aria-hidden="true" tabindex="-1"></a>          <span class="st">"evt"</span> <span class="sc">~</span> </span>
<span id="cb11-182"><a href="#cb11-182" aria-hidden="true" tabindex="-1"></a>            rastfile <span class="sc">%&gt;%</span></span>
<span id="cb11-183"><a href="#cb11-183" aria-hidden="true" tabindex="-1"></a>            stringr<span class="sc">::</span><span class="fu">str_replace</span>(<span class="st">"Tif"</span>, <span class="st">"CSV_Data"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-184"><a href="#cb11-184" aria-hidden="true" tabindex="-1"></a>            stringr<span class="sc">::</span><span class="fu">str_replace</span>(<span class="st">".tif"</span>, <span class="st">".csv"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-185"><a href="#cb11-185" aria-hidden="true" tabindex="-1"></a>            stringr<span class="sc">::</span><span class="fu">str_replace</span>(<span class="st">"LC23"</span>, <span class="st">"LF23"</span>)</span>
<span id="cb11-186"><a href="#cb11-186" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb11-187"><a href="#cb11-187" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb11-188"><a href="#cb11-188" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb11-189"><a href="#cb11-189" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb11-190"><a href="#cb11-190" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb11-191"><a href="#cb11-191" aria-hidden="true" tabindex="-1"></a>      <span class="at">rast =</span> </span>
<span id="cb11-192"><a href="#cb11-192" aria-hidden="true" tabindex="-1"></a>        <span class="fu">read_and_write_landfire</span>(</span>
<span id="cb11-193"><a href="#cb11-193" aria-hidden="true" tabindex="-1"></a>          <span class="at">raster =</span> rastfile,</span>
<span id="cb11-194"><a href="#cb11-194" aria-hidden="true" tabindex="-1"></a>          <span class="at">levels =</span> levelsfile,</span>
<span id="cb11-195"><a href="#cb11-195" aria-hidden="true" tabindex="-1"></a>          <span class="at">outfile =</span> <span class="fu">file.path</span>(<span class="st">"data-derived"</span>, <span class="fu">paste0</span>(<span class="st">"landfire_"</span>, dataset, <span class="st">"_swus_paleocar.tif"</span>)))</span>
<span id="cb11-196"><a href="#cb11-196" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb11-197"><a href="#cb11-197" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">ungroup</span>()</span>
<span id="cb11-198"><a href="#cb11-198" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-199"><a href="#cb11-199" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-200"><a href="#cb11-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-201"><a href="#cb11-201" aria-hidden="true" tabindex="-1"></a>read_and_recat <span class="ot">&lt;-</span></span>
<span id="cb11-202"><a href="#cb11-202" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(x, variable){</span>
<span id="cb11-203"><a href="#cb11-203" aria-hidden="true" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">rast</span>(x) <span class="sc">%&gt;%</span></span>
<span id="cb11-204"><a href="#cb11-204" aria-hidden="true" tabindex="-1"></a>      terra<span class="sc">::</span><span class="st">`</span><span class="at">activeCat&lt;-</span><span class="st">`</span>(variable) <span class="sc">%&gt;%</span></span>
<span id="cb11-205"><a href="#cb11-205" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.data.frame</span>(<span class="at">na.rm=</span><span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-206"><a href="#cb11-206" aria-hidden="true" tabindex="-1"></a>      tibble<span class="sc">::</span><span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb11-207"><a href="#cb11-207" aria-hidden="true" tabindex="-1"></a>      terra<span class="sc">::</span><span class="fu">setValues</span>(template, <span class="at">values =</span> .) <span class="sc">%&gt;%</span></span>
<span id="cb11-208"><a href="#cb11-208" aria-hidden="true" tabindex="-1"></a>      magrittr<span class="sc">::</span><span class="fu">set_names</span>(</span>
<span id="cb11-209"><a href="#cb11-209" aria-hidden="true" tabindex="-1"></a>        x <span class="sc">%&gt;%</span></span>
<span id="cb11-210"><a href="#cb11-210" aria-hidden="true" tabindex="-1"></a>          basename <span class="sc">%&gt;%</span></span>
<span id="cb11-211"><a href="#cb11-211" aria-hidden="true" tabindex="-1"></a>          tools<span class="sc">::</span><span class="fu">file_path_sans_ext</span>()</span>
<span id="cb11-212"><a href="#cb11-212" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb11-213"><a href="#cb11-213" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-214"><a href="#cb11-214" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-215"><a href="#cb11-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-216"><a href="#cb11-216" aria-hidden="true" tabindex="-1"></a>landfire <span class="ot">&lt;-</span></span>
<span id="cb11-217"><a href="#cb11-217" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb11-218"><a href="#cb11-218" aria-hidden="true" tabindex="-1"></a>    <span class="at">bps =</span> <span class="fu">read_and_recat</span>(<span class="st">"data-derived/landfire_bps_swus_paleocar.tif"</span>,</span>
<span id="cb11-219"><a href="#cb11-219" aria-hidden="true" tabindex="-1"></a>                         <span class="at">variable =</span> <span class="st">"BPS_NAME"</span>),</span>
<span id="cb11-220"><a href="#cb11-220" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-221"><a href="#cb11-221" aria-hidden="true" tabindex="-1"></a>    <span class="at">evt =</span> <span class="fu">read_and_recat</span>(<span class="st">"data-derived/landfire_evt_swus_paleocar.tif"</span>,</span>
<span id="cb11-222"><a href="#cb11-222" aria-hidden="true" tabindex="-1"></a>                         <span class="at">variable =</span> <span class="st">"EVT_NAME"</span>),</span>
<span id="cb11-223"><a href="#cb11-223" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-224"><a href="#cb11-224" aria-hidden="true" tabindex="-1"></a>    <span class="at">disturbance =</span> <span class="fu">read_and_recat</span>(<span class="st">"data-derived/landfire_disturbance_swus_paleocar.tif"</span>,</span>
<span id="cb11-225"><a href="#cb11-225" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">variable =</span> <span class="st">"DIST_TYPE"</span>)</span>
<span id="cb11-226"><a href="#cb11-226" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb11-227"><a href="#cb11-227" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">rast</span>()</span>
<span id="cb11-228"><a href="#cb11-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-229"><a href="#cb11-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-230"><a href="#cb11-230" aria-hidden="true" tabindex="-1"></a><span class="co"># Recode missing categories</span></span>
<span id="cb11-231"><a href="#cb11-231" aria-hidden="true" tabindex="-1"></a>landfire<span class="sc">$</span>bps <span class="sc">%&lt;&gt;%</span></span>
<span id="cb11-232"><a href="#cb11-232" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>(<span class="at">na.rm=</span><span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-233"><a href="#cb11-233" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb11-234"><a href="#cb11-234" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb11-235"><a href="#cb11-235" aria-hidden="true" tabindex="-1"></a>    <span class="at">bps =</span> </span>
<span id="cb11-236"><a href="#cb11-236" aria-hidden="true" tabindex="-1"></a>      forcats<span class="sc">::</span><span class="fu">fct_recode</span>(</span>
<span id="cb11-237"><a href="#cb11-237" aria-hidden="true" tabindex="-1"></a>        bps,</span>
<span id="cb11-238"><a href="#cb11-238" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Apacherian-Chihuahuan Semi-Desert Shrub-Steppe</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb11-239"><a href="#cb11-239" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Apacherian-Chihuahuan Semi-Desert Grassland and Steppe"</span>,</span>
<span id="cb11-240"><a href="#cb11-240" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Apacherian-Chihuahuan Semi-Desert Grassland</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb11-241"><a href="#cb11-241" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Apacherian-Chihuahuan Mesquite Upland Scrub"</span>,</span>
<span id="cb11-242"><a href="#cb11-242" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Chihuahuan Mixed Desert and Thornscrub</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb11-243"><a href="#cb11-243" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Chihuahuan Mixed Desert and Thorn Scrub"</span>,</span>
<span id="cb11-244"><a href="#cb11-244" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Chihuahuan Mixed Desert and Thornscrub</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb11-245"><a href="#cb11-245" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Chihuahuan Mixed Desert and Thorn Scrub-Shrubland"</span>,</span>
<span id="cb11-246"><a href="#cb11-246" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Chihuahuan Mixed Desert and Thornscrub</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb11-247"><a href="#cb11-247" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Chihuahuan Mixed Desert and Thorn Scrub-Steppe"</span>,</span>
<span id="cb11-248"><a href="#cb11-248" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Chihuahuan-Sonoran Desert Bottomland and Swale Grassland</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb11-249"><a href="#cb11-249" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Chihuahuan-Sonoran Desert Bottomland and Swale Grassland-Alkali Sacaton"</span>,</span>
<span id="cb11-250"><a href="#cb11-250" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Chihuahuan-Sonoran Desert Bottomland and Swale Grassland</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb11-251"><a href="#cb11-251" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Chihuahuan-Sonoran Desert Bottomland and Swale Grassland-Tobosa Grassland"</span>,</span>
<span id="cb11-252"><a href="#cb11-252" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Inter-Mountain Basins Aspen-Mixed Conifer Forest and Woodland</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb11-253"><a href="#cb11-253" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Inter-Mountain Basins Aspen-Mixed Conifer Forest and Woodland-High Elevation"</span>,</span>
<span id="cb11-254"><a href="#cb11-254" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Inter-Mountain Basins Aspen-Mixed Conifer Forest and Woodland</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb11-255"><a href="#cb11-255" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Inter-Mountain Basins Aspen-Mixed Conifer Forest and Woodland-Low Elevation"</span>,</span>
<span id="cb11-256"><a href="#cb11-256" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Inter-Mountain Basins Big Sagebrush Shrubland</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb11-257"><a href="#cb11-257" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Inter-Mountain Basins Big Sagebrush Shrubland-Basin Big Sagebrush"</span>,</span>
<span id="cb11-258"><a href="#cb11-258" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Inter-Mountain Basins Big Sagebrush Shrubland</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb11-259"><a href="#cb11-259" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Inter-Mountain Basins Big Sagebrush Shrubland-Semi-Desert"</span>,</span>
<span id="cb11-260"><a href="#cb11-260" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Inter-Mountain Basins Big Sagebrush Shrubland</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb11-261"><a href="#cb11-261" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Inter-Mountain Basins Big Sagebrush Shrubland-Upland"</span>,</span>
<span id="cb11-262"><a href="#cb11-262" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Inter-Mountain Basins Big Sagebrush Shrubland</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb11-263"><a href="#cb11-263" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Inter-Mountain Basins Big Sagebrush Shrubland-Wyoming Big Sagebrush"</span>,</span>
<span id="cb11-264"><a href="#cb11-264" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Inter-Mountain Basins Montane Sagebrush Steppe</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb11-265"><a href="#cb11-265" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Inter-Mountain Basins Montane Sagebrush Steppe-Low Sagebrush"</span>,</span>
<span id="cb11-266"><a href="#cb11-266" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Inter-Mountain Basins Montane Sagebrush Steppe</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb11-267"><a href="#cb11-267" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Inter-Mountain Basins Montane Sagebrush Steppe-Mountain Big Sagebrush"</span>,</span>
<span id="cb11-268"><a href="#cb11-268" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Rocky Mountain Gambel Oak-Mixed Montane Shrubland</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb11-269"><a href="#cb11-269" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Rocky Mountain Gambel Oak-Mixed Montane Shrubland -Continuous"</span>,</span>
<span id="cb11-270"><a href="#cb11-270" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Rocky Mountain Gambel Oak-Mixed Montane Shrubland</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb11-271"><a href="#cb11-271" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Rocky Mountain Gambel Oak-Mixed Montane Shrubland-Patchy"</span>,</span>
<span id="cb11-272"><a href="#cb11-272" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Rocky Mountain Lower Montane-Foothill Shrubland</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb11-273"><a href="#cb11-273" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Rocky Mountain Lower Montane-Foothill Shrubland-No True Mountain Mahogany"</span>,</span>
<span id="cb11-274"><a href="#cb11-274" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Rocky Mountain Lower Montane-Foothill Shrubland</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb11-275"><a href="#cb11-275" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Rocky Mountain Lower Montane-Foothill Shrubland-True Mountain Mahogany"</span>,</span>
<span id="cb11-276"><a href="#cb11-276" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Southern Rocky Mountain Ponderosa Pine Savanna</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb11-277"><a href="#cb11-277" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Southern Rocky Mountain Ponderosa Pine Savanna-North"</span>,</span>
<span id="cb11-278"><a href="#cb11-278" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Southern Rocky Mountain Ponderosa Pine Woodland</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb11-279"><a href="#cb11-279" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Southern Rocky Mountain Ponderosa Pine Woodland-North"</span>,</span>
<span id="cb11-280"><a href="#cb11-280" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Southern Rocky Mountain Ponderosa Pine Woodland</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb11-281"><a href="#cb11-281" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Southern Rocky Mountain Ponderosa Pine Woodland-South"</span>,</span>
<span id="cb11-282"><a href="#cb11-282" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Western Great Plains Closed Depression Wetland</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb11-283"><a href="#cb11-283" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Western Great Plains Depressional Wetland Systems"</span>,</span>
<span id="cb11-284"><a href="#cb11-284" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Western Great Plains Closed Depression Wetland</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb11-285"><a href="#cb11-285" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Western Great Plains Depressional Wetland Systems-Playa"</span>,</span>
<span id="cb11-286"><a href="#cb11-286" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Western Great Plains Closed Depression Wetland</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb11-287"><a href="#cb11-287" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Western Great Plains Depressional Wetland Systems-Saline"</span>,</span>
<span id="cb11-288"><a href="#cb11-288" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Western Great Plains Tallgrass Prairie</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb11-289"><a href="#cb11-289" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Central Tallgrass Prairie"</span>,</span>
<span id="cb11-290"><a href="#cb11-290" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Inter-Mountain Basins Wash</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb11-291"><a href="#cb11-291" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Inter-Mountain Basins Montane Riparian Systems"</span>,</span>
<span id="cb11-292"><a href="#cb11-292" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">North American Warm Desert Riparian Systems</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb11-293"><a href="#cb11-293" aria-hidden="true" tabindex="-1"></a>          <span class="st">"North American Warm Desert Riparian Systems-Stringers"</span>,</span>
<span id="cb11-294"><a href="#cb11-294" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">North American Glacier and Ice Field</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb11-295"><a href="#cb11-295" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Perennial Ice/Snow"</span>,</span>
<span id="cb11-296"><a href="#cb11-296" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Northwestern Great Plains-Black Hills Ponderosa Pine Woodland and Savanna</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb11-297"><a href="#cb11-297" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Northwestern Great Plains-Black Hills Ponderosa Pine Woodland and Savanna-Savanna"</span>,</span>
<span id="cb11-298"><a href="#cb11-298" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Western Great Plains Badlands</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb11-299"><a href="#cb11-299" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Western Great Plains Sparsely Vegetated Systems"</span>,</span>
<span id="cb11-300"><a href="#cb11-300" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">North American Warm Desert Badland</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb11-301"><a href="#cb11-301" aria-hidden="true" tabindex="-1"></a>          <span class="st">"North American Warm Desert Sparsely Vegetated Systems"</span>,</span>
<span id="cb11-302"><a href="#cb11-302" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Rocky Mountain Alpine-Montane Wet Meadow</span><span class="st">`</span> <span class="ot">=</span></span>
<span id="cb11-303"><a href="#cb11-303" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Northern Rocky Mountain Conifer Swamp"</span>,</span>
<span id="cb11-304"><a href="#cb11-304" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Barren-Rock/Sand/Clay</span><span class="st">`</span> <span class="ot">=</span></span>
<span id="cb11-305"><a href="#cb11-305" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Inter-Mountain Basins Sparsely Vegetated Systems"</span>,</span>
<span id="cb11-306"><a href="#cb11-306" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Barren-Rock/Sand/Clay</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb11-307"><a href="#cb11-307" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Rocky Mountain Alpine/Montane Sparsely Vegetated Systems"</span>,</span>
<span id="cb11-308"><a href="#cb11-308" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Barren-Rock/Sand/Clay</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb11-309"><a href="#cb11-309" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Inter-Mountain Basins Sparsely Vegetated Systems"</span>,</span>
<span id="cb11-310"><a href="#cb11-310" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Northwestern Great Plains Floodplain Herbaceous</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb11-311"><a href="#cb11-311" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Northwestern Great Plains Canyon"</span>,</span>
<span id="cb11-312"><a href="#cb11-312" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Southern Rocky Mountain Ponderosa Pine Woodland</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb11-313"><a href="#cb11-313" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Northwestern Great Plains Highland White Spruce Woodland"</span>,</span>
<span id="cb11-314"><a href="#cb11-314" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Rocky Mountain Lodgepole Pine Forest</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb11-315"><a href="#cb11-315" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Rocky Mountain Poor-Site Lodgepole Pine Forest"</span>,</span>
<span id="cb11-316"><a href="#cb11-316" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Central Mixedgrass Prairie</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb11-317"><a href="#cb11-317" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Western Great Plains Wooded Draw and Ravine"</span>,</span>
<span id="cb11-318"><a href="#cb11-318" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Inter-Mountain Basins Big Sagebrush Steppe</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb11-319"><a href="#cb11-319" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Inter-Mountain Basins Big Sagebrush Shrubland"</span></span>
<span id="cb11-320"><a href="#cb11-320" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb11-321"><a href="#cb11-321" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb11-322"><a href="#cb11-322" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">setValues</span>(template, <span class="at">values =</span> .)</span>
<span id="cb11-323"><a href="#cb11-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-324"><a href="#cb11-324" aria-hidden="true" tabindex="-1"></a>landfire<span class="sc">$</span>evt <span class="sc">%&lt;&gt;%</span></span>
<span id="cb11-325"><a href="#cb11-325" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>(<span class="at">na.rm=</span><span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-326"><a href="#cb11-326" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb11-327"><a href="#cb11-327" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb11-328"><a href="#cb11-328" aria-hidden="true" tabindex="-1"></a>    <span class="at">evt =</span> </span>
<span id="cb11-329"><a href="#cb11-329" aria-hidden="true" tabindex="-1"></a>      forcats<span class="sc">::</span><span class="fu">fct_recode</span>(</span>
<span id="cb11-330"><a href="#cb11-330" aria-hidden="true" tabindex="-1"></a>        evt,</span>
<span id="cb11-331"><a href="#cb11-331" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Central Mixedgrass Prairie</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb11-332"><a href="#cb11-332" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Central Mixedgrass Prairie Grassland"</span>,</span>
<span id="cb11-333"><a href="#cb11-333" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Central Mixedgrass Prairie</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb11-334"><a href="#cb11-334" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Central Mixedgrass Prairie Shrubland"</span>,</span>
<span id="cb11-335"><a href="#cb11-335" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Inter-Mountain Basins Curl-leaf Mountain Mahogany Woodland and Shrubland</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb11-336"><a href="#cb11-336" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Inter-Mountain Basins Curl-leaf Mountain Mahogany Shrubland"</span>,</span>
<span id="cb11-337"><a href="#cb11-337" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Inter-Mountain Basins Curl-leaf Mountain Mahogany Woodland and Shrubland</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb11-338"><a href="#cb11-338" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Inter-Mountain Basins Curl-leaf Mountain Mahogany Woodland"</span>,</span>
<span id="cb11-339"><a href="#cb11-339" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Rocky Mountain Subalpine/Upper Montane Riparian Systems</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb11-340"><a href="#cb11-340" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Rocky Mountain Subalpine-Montane Riparian Shrubland"</span>,</span>
<span id="cb11-341"><a href="#cb11-341" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Rocky Mountain Subalpine/Upper Montane Riparian Systems</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb11-342"><a href="#cb11-342" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Rocky Mountain Subalpine-Montane Riparian Woodland"</span>,         </span>
<span id="cb11-343"><a href="#cb11-343" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Western Great Plains Floodplain Systems</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb11-344"><a href="#cb11-344" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Western Great Plains Floodplain Herbaceous"</span>,</span>
<span id="cb11-345"><a href="#cb11-345" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Western Great Plains Floodplain Systems</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb11-346"><a href="#cb11-346" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Western Great Plains Floodplain Shrubland"</span>,</span>
<span id="cb11-347"><a href="#cb11-347" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Western Great Plains Mesquite Woodland and Shrubland</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb11-348"><a href="#cb11-348" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Western Great Plains Mesquite Shrubland"</span>,</span>
<span id="cb11-349"><a href="#cb11-349" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">North American Warm Desert Riparian Systems</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb11-350"><a href="#cb11-350" aria-hidden="true" tabindex="-1"></a>          <span class="st">"North American Warm Desert Riparian Woodland"</span>,</span>
<span id="cb11-351"><a href="#cb11-351" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">North American Warm Desert Riparian Systems</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb11-352"><a href="#cb11-352" aria-hidden="true" tabindex="-1"></a>          <span class="st">"North American Warm Desert Riparian Shrubland"</span>,</span>
<span id="cb11-353"><a href="#cb11-353" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Rocky Mountain Montane Riparian Systems</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb11-354"><a href="#cb11-354" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Rocky Mountain Lower Montane-Foothill Riparian Shrubland"</span>,</span>
<span id="cb11-355"><a href="#cb11-355" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Rocky Mountain Montane Riparian Systems</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb11-356"><a href="#cb11-356" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Rocky Mountain Lower Montane-Foothill Riparian Woodland"</span>,</span>
<span id="cb11-357"><a href="#cb11-357" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Rocky Mountain Alpine/Montane Sparsely Vegetated Systems</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb11-358"><a href="#cb11-358" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Rocky Mountain Alpine Bedrock and Scree"</span>,</span>
<span id="cb11-359"><a href="#cb11-359" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Barren-Rock/Sand/Clay</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb11-360"><a href="#cb11-360" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Colorado Plateau Mixed Bedrock Canyon and Tableland"</span>,</span>
<span id="cb11-361"><a href="#cb11-361" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Barren-Rock/Sand/Clay</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb11-362"><a href="#cb11-362" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Inter-Mountain Basins Shale Badland"</span>,</span>
<span id="cb11-363"><a href="#cb11-363" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Barren-Rock/Sand/Clay</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb11-364"><a href="#cb11-364" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Inter-Mountain Basins Playa"</span>,</span>
<span id="cb11-365"><a href="#cb11-365" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Barren-Rock/Sand/Clay</span><span class="st">`</span> <span class="ot">=</span></span>
<span id="cb11-366"><a href="#cb11-366" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Inter-Mountain Basins Active and Stabilized Dune"</span>,</span>
<span id="cb11-367"><a href="#cb11-367" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Barren-Rock/Sand/Clay</span><span class="st">`</span> <span class="ot">=</span></span>
<span id="cb11-368"><a href="#cb11-368" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Inter-Mountain Basins Volcanic Rock and Cinder Land"</span>,</span>
<span id="cb11-369"><a href="#cb11-369" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Barren-Rock/Sand/Clay</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb11-370"><a href="#cb11-370" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Rocky Mountain Cliff Canyon and Massive Bedrock"</span>,</span>
<span id="cb11-371"><a href="#cb11-371" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Apacherian-Chihuahuan Semi-Desert Shrub-Steppe</span><span class="st">`</span> <span class="ot">=</span></span>
<span id="cb11-372"><a href="#cb11-372" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Edwards Plateau Limestone Shrubland"</span>,</span>
<span id="cb11-373"><a href="#cb11-373" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Inter-Mountain Basins Big Sagebrush Steppe</span><span class="st">`</span> <span class="ot">=</span></span>
<span id="cb11-374"><a href="#cb11-374" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Inter-Mountain Basins Big Sagebrush Shrubland"</span>,</span>
<span id="cb11-375"><a href="#cb11-375" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Inter-Mountain Basins Big Sagebrush Steppe</span><span class="st">`</span> <span class="ot">=</span></span>
<span id="cb11-376"><a href="#cb11-376" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Columbia Plateau Steppe and Grassland"</span>,</span>
<span id="cb11-377"><a href="#cb11-377" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Inter-Mountain Basins Mixed Salt Desert Scrub</span><span class="st">`</span> <span class="ot">=</span></span>
<span id="cb11-378"><a href="#cb11-378" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Great Basin &amp; Intermountain Ruderal Shrubland"</span>,</span>
<span id="cb11-379"><a href="#cb11-379" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Barren-Rock/Sand/Clay</span><span class="st">`</span> <span class="ot">=</span></span>
<span id="cb11-380"><a href="#cb11-380" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Rocky Mountain Alpine/Montane Sparsely Vegetated Systems"</span>,</span>
<span id="cb11-381"><a href="#cb11-381" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Barren-Rock/Sand/Clay</span><span class="st">`</span> <span class="ot">=</span></span>
<span id="cb11-382"><a href="#cb11-382" aria-hidden="true" tabindex="-1"></a>          <span class="st">"North American Warm Desert Active and Stabilized Dune"</span>,</span>
<span id="cb11-383"><a href="#cb11-383" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Apacherian-Chihuahuan Semi-Desert Shrub-Steppe</span><span class="st">`</span> <span class="ot">=</span></span>
<span id="cb11-384"><a href="#cb11-384" aria-hidden="true" tabindex="-1"></a>          <span class="st">"North American Warm Desert Ruderal &amp; Planted Scrub"</span>,</span>
<span id="cb11-385"><a href="#cb11-385" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Barren-Rock/Sand/Clay</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb11-386"><a href="#cb11-386" aria-hidden="true" tabindex="-1"></a>          <span class="st">"North American Warm Desert Playa"</span>,</span>
<span id="cb11-387"><a href="#cb11-387" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Inter-Mountain Basins Big Sagebrush Steppe</span><span class="st">`</span> <span class="ot">=</span></span>
<span id="cb11-388"><a href="#cb11-388" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Inter-Mountain Basins Cliff and Canyon"</span>,</span>
<span id="cb11-389"><a href="#cb11-389" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Mojave Mid-Elevation Mixed Desert Scrub</span><span class="st">`</span> <span class="ot">=</span></span>
<span id="cb11-390"><a href="#cb11-390" aria-hidden="true" tabindex="-1"></a>          <span class="st">"North American Warm Desert Bedrock Cliff and Outcrop"</span>,</span>
<span id="cb11-391"><a href="#cb11-391" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">North American Warm Desert Badland</span><span class="st">`</span> <span class="ot">=</span></span>
<span id="cb11-392"><a href="#cb11-392" aria-hidden="true" tabindex="-1"></a>          <span class="st">"North American Warm Desert Pavement"</span>,</span>
<span id="cb11-393"><a href="#cb11-393" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Inter-Mountain Basins Greasewood Flat</span><span class="st">`</span> <span class="ot">=</span></span>
<span id="cb11-394"><a href="#cb11-394" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Interior Western North American Temperate Ruderal Shrubland"</span></span>
<span id="cb11-395"><a href="#cb11-395" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb11-396"><a href="#cb11-396" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb11-397"><a href="#cb11-397" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">setValues</span>(template, <span class="at">values =</span> .)</span>
<span id="cb11-398"><a href="#cb11-398" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning: There was 1 warning in `dplyr::mutate()`.</span></span>
<span id="cb11-399"><a href="#cb11-399" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ℹ In argument: `evt = forcats::fct_recode(...)`.</span></span>
<span id="cb11-400"><a href="#cb11-400" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Caused by warning:</span></span>
<span id="cb11-401"><a href="#cb11-401" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ! Unknown levels in `f`: Rocky Mountain Alpine/Montane Sparsely Vegetated Systems</span></span>
<span id="cb11-402"><a href="#cb11-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-403"><a href="#cb11-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-404"><a href="#cb11-404" aria-hidden="true" tabindex="-1"></a><span class="co"># PRISM Elevation</span></span>
<span id="cb11-405"><a href="#cb11-405" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(<span class="st">"data-derived/elev_swus_paleocar.tif"</span>)){</span>
<span id="cb11-406"><a href="#cb11-406" aria-hidden="true" tabindex="-1"></a>  elev <span class="ot">&lt;-</span></span>
<span id="cb11-407"><a href="#cb11-407" aria-hidden="true" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">rast</span>(<span class="st">"/vsizip//vsicurl/https://data.prism.oregonstate.edu/normals_bil/monthly/800m/dem/PRISM_us_dem_800m_bil.zip/PRISM_us_dem_800m_bil.bil"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-408"><a href="#cb11-408" aria-hidden="true" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">crop</span>(template) <span class="sc">%&gt;%</span></span>
<span id="cb11-409"><a href="#cb11-409" aria-hidden="true" tabindex="-1"></a>    magrittr<span class="sc">::</span><span class="fu">set_names</span>(<span class="st">"elev"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-410"><a href="#cb11-410" aria-hidden="true" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">writeRaster</span>(</span>
<span id="cb11-411"><a href="#cb11-411" aria-hidden="true" tabindex="-1"></a>      <span class="at">filename =</span> <span class="st">"data-derived/elev_swus_paleocar.tif"</span>,</span>
<span id="cb11-412"><a href="#cb11-412" aria-hidden="true" tabindex="-1"></a>      <span class="at">datatype =</span> <span class="st">"INT4S"</span>,</span>
<span id="cb11-413"><a href="#cb11-413" aria-hidden="true" tabindex="-1"></a>      <span class="at">overwrite =</span> <span class="cn">TRUE</span>,</span>
<span id="cb11-414"><a href="#cb11-414" aria-hidden="true" tabindex="-1"></a>      <span class="at">gdal =</span> <span class="fu">c</span>(<span class="st">"COMPRESS=ZSTD"</span>),</span>
<span id="cb11-415"><a href="#cb11-415" aria-hidden="true" tabindex="-1"></a>      <span class="at">memfrac =</span> <span class="fl">0.9</span></span>
<span id="cb11-416"><a href="#cb11-416" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-417"><a href="#cb11-417" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-418"><a href="#cb11-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-419"><a href="#cb11-419" aria-hidden="true" tabindex="-1"></a>elev <span class="ot">&lt;-</span> </span>
<span id="cb11-420"><a href="#cb11-420" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">rast</span>(<span class="st">"data-derived/elev_swus_paleocar.tif"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We trained LightGBM (Ke et al.&nbsp;2017) quantile regression models to predict log-transformed NPP at the 10th, 50th, and 90th percentiles. Our models treated EVT, disturbance type, and irrigated lands as categorical predictors and elevation, latitude, and longitude as continuous predictors. After training, we used these models to generate NPP predictions across the study area under a no-irrigation, no-disturbance scenario. We visualized the resulting median (50%) NPP map as a baseline productivity surface (<a href="#suppfig-s3" class="quarto-xref">Figure S3</a>). We then multiplied this surface by the proportion of years meeting Maize Farming Niche (MFN) thresholds to generate maps of “niche-attenuated NPP” (<a href="#suppfig-s4" class="quarto-xref">Figure S4</a>). Finally, we normalized these values relative to the central Mesa Verde region to estimate relative productivity maps (<a href="#suppfig-s5" class="quarto-xref">Figure S5</a>) that highlight agricultural potential across the Chaco Basin.</p>
</section>
</section>
<section id="estimating-pre-european-net-primary-productivity-npp-using-gradient-boosted-models" class="level3">
<h3 class="anchored" data-anchor-id="estimating-pre-european-net-primary-productivity-npp-using-gradient-boosted-models">Estimating Pre-European Net Primary Productivity (NPP) Using Gradient Boosted Models</h3>
<p>This code fits a quantile-based LightGBM (Gradient Boosted Machine) model to estimate <strong>pre-European NPP</strong> based on landscape characteristics in the U.S. Southwest. The process includes the following steps:</p>
<ol type="1">
<li><strong>Data Assembly</strong>
<ul>
<li>We construct a spatial dataset (<code>landscape_data</code>) by combining:
<ul>
<li>LANDFIRE Biophysical Settings (BPS), Existing Vegetation Types (EVT), and Disturbance data</li>
<li>PRISM elevation</li>
<li>MODIS-derived NPP (for years 2002, 2007, 2012, 2017)</li>
<li>MIRAD irrigated lands</li>
</ul></li>
<li>Data are merged by year and converted to tidy, long format.</li>
</ul></li>
<li><strong>Training Data Preparation</strong>
<ul>
<li>We convert categorical predictors to integers, remove missing values, and drop unused fields (e.g., year, BPS).</li>
<li>The response variable is the natural log of NPP plus one (<code>log1p(NPP)</code>), which helps handle skewed data.</li>
</ul></li>
<li><strong>Model Fitting</strong>
<ul>
<li>We fit three LightGBM quantile regression models, targeting the 10th, 50th, and 90th percentiles of NPP.</li>
<li>Models are trained using <code>furrr::future_map()</code> in parallel (multisession) to speed up computation.</li>
</ul></li>
<li><strong>Prediction</strong>
<ul>
<li>We simulate a “pre-European” landscape by assuming:
<ul>
<li>No irrigation (<code>mirad_irrlands = 0</code>)</li>
<li>No recent disturbance (<code>disturbance = 'Non Disturbed'</code>)</li>
</ul></li>
<li>We generate predictions for each quantile, back-transform the output with <code>expm1()</code>, and mask predictions to valid elevation areas.</li>
</ul></li>
<li><strong>Output</strong>
<ul>
<li>Predicted rasters are stacked and written to disk as <code>"data-derived/pre-european_npp_swus.tif"</code>.</li>
</ul></li>
<li><strong>Load Results</strong>
<ul>
<li>The final raster stack is loaded into the object <code>modeled_production</code> for use in subsequent analysis.</li>
</ul></li>
</ol>
<p>This approach provides a modeled baseline for potential productivity in the absence of modern anthropogenic influences.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Fit a GBM model to estimate NPP from Biophysical Setting</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(<span class="st">"data-derived/pre-european_npp_swus.tif"</span>)){</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  raster_to_long_tibble <span class="ot">&lt;-</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">function</span>(x, ...){</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>      x <span class="sc">%&gt;%</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">as.data.frame</span>(<span class="at">xy =</span> <span class="cn">TRUE</span>,</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>                      <span class="at">na.rm =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>        tibble<span class="sc">::</span><span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>        tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="sc">!</span><span class="fu">c</span>(x,y),</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>                            ...)</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>  landscape_data <span class="ot">&lt;-</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>      landfire<span class="sc">$</span>bps,</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>      landfire<span class="sc">$</span>evt,</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>      landfire<span class="sc">$</span>disturbance,</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>      elev</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">rast</span>() <span class="sc">%&gt;%</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.data.frame</span>(<span class="at">xy =</span> <span class="cn">TRUE</span>,</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>                  <span class="at">na.rm =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    tibble<span class="sc">::</span><span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">evt =</span> <span class="fu">factor</span>(evt,</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>                               <span class="at">ordered =</span> <span class="cn">TRUE</span>),</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>                  <span class="at">bps =</span> <span class="fu">factor</span>(bps,</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>                               <span class="at">levels =</span> <span class="fu">levels</span>(evt),</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>                               <span class="at">ordered =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>      modis_npp <span class="sc">%&gt;%</span> </span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>        magrittr<span class="sc">::</span><span class="fu">set_names</span>(<span class="fu">c</span>(<span class="dv">2002</span>, <span class="dv">2007</span>, <span class="dv">2012</span>, <span class="dv">2017</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>        <span class="fu">raster_to_long_tibble</span>(<span class="at">names_to =</span> <span class="st">"year"</span>, <span class="at">values_to =</span> <span class="st">"NPP"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.integer</span>(year))</span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>      mirad_irrlands <span class="sc">%&gt;%</span></span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>        magrittr<span class="sc">::</span><span class="fu">set_names</span>(<span class="fu">c</span>(<span class="dv">2002</span>, <span class="dv">2007</span>, <span class="dv">2012</span>, <span class="dv">2017</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>        <span class="fu">raster_to_long_tibble</span>(<span class="at">names_to =</span> <span class="st">"year"</span>, <span class="at">values_to =</span> <span class="st">"mirad_irrlands"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.integer</span>(year))</span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>  training_data <span class="ot">&lt;-</span></span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a>    landscape_data <span class="sc">%&gt;%</span></span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(dplyr<span class="sc">::</span><span class="fu">across</span>(<span class="fu">c</span>(evt, disturbance, mirad_irrlands), </span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a>                                as.integer)) <span class="sc">%&gt;%</span></span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(NPP)) <span class="sc">%&gt;%</span></span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">na.omit</span>() <span class="sc">%&gt;%</span></span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span><span class="fu">c</span>(year, bps))</span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plan</span>(multisession, <span class="at">workers =</span> <span class="dv">3</span>)</span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a>  lgb_mods <span class="ot">&lt;-</span></span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="st">`</span><span class="at">10%</span><span class="st">`</span> <span class="ot">=</span> <span class="fl">0.1</span>, </span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">50%</span><span class="st">`</span> <span class="ot">=</span> <span class="fl">0.5</span>, </span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">90%</span><span class="st">`</span> <span class="ot">=</span> <span class="fl">0.9</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-59"><a href="#cb12-59" aria-hidden="true" tabindex="-1"></a>    furrr<span class="sc">::</span><span class="fu">future_map</span>(</span>
<span id="cb12-60"><a href="#cb12-60" aria-hidden="true" tabindex="-1"></a>      \(x){</span>
<span id="cb12-61"><a href="#cb12-61" aria-hidden="true" tabindex="-1"></a>        training_data <span class="sc">%&gt;%</span></span>
<span id="cb12-62"><a href="#cb12-62" aria-hidden="true" tabindex="-1"></a>          {</span>
<span id="cb12-63"><a href="#cb12-63" aria-hidden="true" tabindex="-1"></a>            <span class="fu">lgb.train</span>(</span>
<span id="cb12-64"><a href="#cb12-64" aria-hidden="true" tabindex="-1"></a>              <span class="at">data =</span> <span class="fu">lgb.Dataset</span>(</span>
<span id="cb12-65"><a href="#cb12-65" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> <span class="fu">as.matrix</span>(dplyr<span class="sc">::</span><span class="fu">select</span>(., <span class="sc">!</span>NPP)), </span>
<span id="cb12-66"><a href="#cb12-66" aria-hidden="true" tabindex="-1"></a>                <span class="at">label =</span> <span class="fu">log1p</span>(.<span class="sc">$</span>NPP),</span>
<span id="cb12-67"><a href="#cb12-67" aria-hidden="true" tabindex="-1"></a>                <span class="at">categorical_feature =</span> </span>
<span id="cb12-68"><a href="#cb12-68" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">c</span>(<span class="st">"evt"</span>, <span class="st">"disturbance"</span>, <span class="st">"mirad_irrlands"</span>)),</span>
<span id="cb12-69"><a href="#cb12-69" aria-hidden="true" tabindex="-1"></a>              <span class="at">params =</span> <span class="fu">list</span>(<span class="at">objective =</span> <span class="st">"quantile"</span>,</span>
<span id="cb12-70"><a href="#cb12-70" aria-hidden="true" tabindex="-1"></a>                            <span class="co"># metric = "quantile",</span></span>
<span id="cb12-71"><a href="#cb12-71" aria-hidden="true" tabindex="-1"></a>                            <span class="at">alpha =</span> x,</span>
<span id="cb12-72"><a href="#cb12-72" aria-hidden="true" tabindex="-1"></a>                            <span class="at">metric =</span> <span class="st">"rmse"</span>,</span>
<span id="cb12-73"><a href="#cb12-73" aria-hidden="true" tabindex="-1"></a>                            <span class="at">num_leaves =</span> <span class="dv">31</span>,</span>
<span id="cb12-74"><a href="#cb12-74" aria-hidden="true" tabindex="-1"></a>                            <span class="at">learning_rate =</span> <span class="fl">0.05</span>),</span>
<span id="cb12-75"><a href="#cb12-75" aria-hidden="true" tabindex="-1"></a>              <span class="at">nrounds =</span> <span class="dv">500</span>L,</span>
<span id="cb12-76"><a href="#cb12-76" aria-hidden="true" tabindex="-1"></a>              <span class="at">verbose =</span> <span class="dv">1</span>  <span class="co"># Show training progress </span></span>
<span id="cb12-77"><a href="#cb12-77" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb12-78"><a href="#cb12-78" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb12-79"><a href="#cb12-79" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb12-80"><a href="#cb12-80" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-81"><a href="#cb12-81" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-82"><a href="#cb12-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plan</span>(sequential)</span>
<span id="cb12-83"><a href="#cb12-83" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-84"><a href="#cb12-84" aria-hidden="true" tabindex="-1"></a>  prediction_data <span class="ot">&lt;-</span></span>
<span id="cb12-85"><a href="#cb12-85" aria-hidden="true" tabindex="-1"></a>    landscape_data <span class="sc">%&gt;%</span></span>
<span id="cb12-86"><a href="#cb12-86" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">disturbance =</span> <span class="fu">factor</span>(<span class="st">"Non Disturbed"</span>,</span>
<span id="cb12-87"><a href="#cb12-87" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">levels =</span> <span class="fu">levels</span>(disturbance)),</span>
<span id="cb12-88"><a href="#cb12-88" aria-hidden="true" tabindex="-1"></a>                  <span class="at">mirad_irrlands =</span> <span class="dv">0</span>L) <span class="sc">%&gt;%</span></span>
<span id="cb12-89"><a href="#cb12-89" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(dplyr<span class="sc">::</span><span class="fu">across</span>(<span class="fu">c</span>(bps, evt, disturbance, mirad_irrlands), </span>
<span id="cb12-90"><a href="#cb12-90" aria-hidden="true" tabindex="-1"></a>                                as.integer)) <span class="sc">%&gt;%</span></span>
<span id="cb12-91"><a href="#cb12-91" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span><span class="fu">c</span>(NPP, year, evt)) <span class="sc">%&gt;%</span></span>
<span id="cb12-92"><a href="#cb12-92" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">evt =</span> bps) <span class="sc">%&gt;%</span></span>
<span id="cb12-93"><a href="#cb12-93" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb12-94"><a href="#cb12-94" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb12-95"><a href="#cb12-95" aria-hidden="true" tabindex="-1"></a>      template <span class="sc">%&gt;%</span></span>
<span id="cb12-96"><a href="#cb12-96" aria-hidden="true" tabindex="-1"></a>        <span class="fu">as.data.frame</span>(<span class="at">xy =</span> <span class="cn">TRUE</span>,</span>
<span id="cb12-97"><a href="#cb12-97" aria-hidden="true" tabindex="-1"></a>                      <span class="at">na.rm =</span> <span class="cn">FALSE</span>,</span>
<span id="cb12-98"><a href="#cb12-98" aria-hidden="true" tabindex="-1"></a>                      <span class="at">cell =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-99"><a href="#cb12-99" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>lyr1), .) <span class="sc">%&gt;%</span></span>
<span id="cb12-100"><a href="#cb12-100" aria-hidden="true" tabindex="-1"></a>    tibble<span class="sc">::</span><span class="fu">tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb12-101"><a href="#cb12-101" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">arrange</span>(cell) <span class="sc">%&gt;%</span></span>
<span id="cb12-102"><a href="#cb12-102" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>cell)</span>
<span id="cb12-103"><a href="#cb12-103" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-104"><a href="#cb12-104" aria-hidden="true" tabindex="-1"></a>  lgb_predictions <span class="ot">&lt;-</span></span>
<span id="cb12-105"><a href="#cb12-105" aria-hidden="true" tabindex="-1"></a>    lgb_mods <span class="sc">%&gt;%</span></span>
<span id="cb12-106"><a href="#cb12-106" aria-hidden="true" tabindex="-1"></a>    purrr<span class="sc">::</span><span class="fu">map</span>(</span>
<span id="cb12-107"><a href="#cb12-107" aria-hidden="true" tabindex="-1"></a>      \(x){</span>
<span id="cb12-108"><a href="#cb12-108" aria-hidden="true" tabindex="-1"></a>        <span class="fu">predict</span>(</span>
<span id="cb12-109"><a href="#cb12-109" aria-hidden="true" tabindex="-1"></a>          x, </span>
<span id="cb12-110"><a href="#cb12-110" aria-hidden="true" tabindex="-1"></a>          <span class="fu">as.matrix</span>(prediction_data)</span>
<span id="cb12-111"><a href="#cb12-111" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span></span>
<span id="cb12-112"><a href="#cb12-112" aria-hidden="true" tabindex="-1"></a>          <span class="fu">expm1</span>() <span class="sc">%&gt;%</span></span>
<span id="cb12-113"><a href="#cb12-113" aria-hidden="true" tabindex="-1"></a>          <span class="fu">pmax</span>(<span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-114"><a href="#cb12-114" aria-hidden="true" tabindex="-1"></a>          terra<span class="sc">::</span><span class="fu">setValues</span>(template, <span class="at">values =</span> .) <span class="sc">%&gt;%</span></span>
<span id="cb12-115"><a href="#cb12-115" aria-hidden="true" tabindex="-1"></a>          terra<span class="sc">::</span><span class="fu">mask</span>(elev)</span>
<span id="cb12-116"><a href="#cb12-116" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb12-117"><a href="#cb12-117" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb12-118"><a href="#cb12-118" aria-hidden="true" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">rast</span>()</span>
<span id="cb12-119"><a href="#cb12-119" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-120"><a href="#cb12-120" aria-hidden="true" tabindex="-1"></a>  lgb_predictions <span class="sc">%&gt;%</span></span>
<span id="cb12-121"><a href="#cb12-121" aria-hidden="true" tabindex="-1"></a>    <span class="fu">round</span>() <span class="sc">%&gt;%</span></span>
<span id="cb12-122"><a href="#cb12-122" aria-hidden="true" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">writeRaster</span>(</span>
<span id="cb12-123"><a href="#cb12-123" aria-hidden="true" tabindex="-1"></a>      <span class="at">filename =</span> <span class="st">"data-derived/pre-european_npp_swus.tif"</span>,</span>
<span id="cb12-124"><a href="#cb12-124" aria-hidden="true" tabindex="-1"></a>      <span class="at">datatype =</span> <span class="st">"INT2U"</span>,</span>
<span id="cb12-125"><a href="#cb12-125" aria-hidden="true" tabindex="-1"></a>      <span class="at">overwrite =</span> <span class="cn">TRUE</span>,</span>
<span id="cb12-126"><a href="#cb12-126" aria-hidden="true" tabindex="-1"></a>      <span class="at">gdal =</span> <span class="fu">c</span>(<span class="st">"COMPRESS=ZSTD"</span>),</span>
<span id="cb12-127"><a href="#cb12-127" aria-hidden="true" tabindex="-1"></a>      <span class="at">memfrac =</span> <span class="fl">0.9</span></span>
<span id="cb12-128"><a href="#cb12-128" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-129"><a href="#cb12-129" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-130"><a href="#cb12-130" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb12-131"><a href="#cb12-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-132"><a href="#cb12-132" aria-hidden="true" tabindex="-1"></a>modeled_production <span class="ot">&lt;-</span></span>
<span id="cb12-133"><a href="#cb12-133" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">rast</span>(<span class="st">"data-derived/pre-european_npp_swus.tif"</span>) <span class="sc">%T&gt;%</span></span>
<span id="cb12-134"><a href="#cb12-134" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">set.values</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_map_array</span>(</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="st">"data-derived/pre-european_npp_swus.tif"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">crop</span>(chaco_basin,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">touches =</span> <span class="cn">FALSE</span>), </span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">12000</span>), </span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">Net Primary Productivity (kg C/ m²)"</span>,</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">labels =</span> \(x){x <span class="sc">*</span> <span class="fl">0.0001</span>},</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">facet =</span> <span class="cn">FALSE</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%T&gt;%</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="at">plot =</span> .,</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">filename =</span> <span class="st">"figures/Figure_s3.png"</span>,</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">device =</span> ragg<span class="sc">::</span>agg_png,</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">width =</span> fig_width, </span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">height =</span> fig_height,</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">bg =</span> <span class="st">"white"</span>,</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">dpi =</span> <span class="dv">600</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="suppfig-s3" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-suppfig figure">
<div aria-describedby="suppfig-s3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figures/Figure_s3-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="3000"></p>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-suppfig" id="suppfig-s3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure S3: Estimated pre-European Net Primary Productivity (NPP) across the U.S. Southwest. We used LightGBM quantile regression to model 10th, 50th (median), and 90th percentile NPP under pre-European conditions—excluding modern irrigation and recent disturbances—based on MODIS NPP data, elevation, and land cover characteristics. The resulting maps provide a baseline of landscape productivity in kg C/m².
</figcaption>
</figure>
</div>
</section>
<section id="calculating-relative-maize-productivity-by-region" class="level3">
<h3 class="anchored" data-anchor-id="calculating-relative-maize-productivity-by-region">Calculating Relative Maize Productivity by Region</h3>
<p>This code estimates <strong>relative maize productivity</strong> by archaeological region and period, scaling modeled productivity values by the mean within a reference region (VEPIIN, 850–1300 CE). This enables cross-regional comparison of potential maize farming success.</p>
<ol type="1">
<li><strong>Define a Scaling Function</strong>
<ul>
<li><code>calculate_relative_raster()</code> divides each cell in a raster (or raster stack) by the mean value within a given area of interest (AOI), so that the AOI’s mean becomes 1.</li>
<li>This normalizes productivity values relative to a baseline region.</li>
</ul></li>
<li><strong>Estimate Period-Specific Productivity</strong>
<ul>
<li>We multiply the maize niche mask for each period (<code>niche_periods</code>) by the median modeled pre-European NPP (<code>modeled_production$"50%"</code>) to calculate potential maize productivity for each period.</li>
</ul></li>
<li><strong>Normalize to VEPIIN</strong>
<ul>
<li>We apply the scaling function to the productivity rasters using VEPIIN (850–1300 CE) as the reference AOI.</li>
<li>This produces <code>relative_production</code>, a raster stack where all values are scaled so that VEPIIN’s mean is 1.</li>
</ul></li>
<li><strong>Summarize by Region</strong>
<ul>
<li>For each region in <code>chaco_regions</code>, we extract the mean relative productivity.</li>
<li>The result is a region-wise summary table with scaled productivity values for each period.</li>
</ul></li>
<li><strong>Export Output</strong>
<ul>
<li>The final table, <code>relative_production_regions</code>, is written to CSV as <code>data-derived/relative_productivity_&lt;PPT_THRESHOLD&gt;.csv</code>.</li>
</ul></li>
</ol>
<p>This analysis helps contextualize agricultural potential across different regions by expressing it relative to a well-studied reference area.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="do">## A function that scales a raster proportional to the mean of an AOI. </span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="do">## The mean of the AOI will be 1.</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>calculate_relative_raster <span class="ot">&lt;-</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(x, aoi){</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    x <span class="sc">%&gt;%</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>      terra<span class="sc">::</span><span class="fu">extract</span>(</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>        aoi,</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">fun =</span> mean,</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">na.rm =</span> <span class="cn">TRUE</span>,</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">touches =</span> <span class="cn">TRUE</span>,</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">ID =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>      purrr<span class="sc">::</span><span class="fu">map2</span>(<span class="at">.y =</span> <span class="fu">as.list</span>(x),</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>                  \(aoi, rast){</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>                    (rast <span class="sc">/</span> aoi)</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>                  }</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>      terra<span class="sc">::</span><span class="fu">rast</span>()</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>niche_npp_periods <span class="ot">&lt;-</span> </span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>  niche_periods <span class="sc">*</span> modeled_production<span class="sc">$</span><span class="st">`</span><span class="at">50%</span><span class="st">`</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>relative_production <span class="ot">&lt;-</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>  niche_npp_periods <span class="sc">%&gt;%</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">calculate_relative_raster</span>(</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">aoi =</span> chaco_regions <span class="sc">%&gt;%</span></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">filter</span>(region <span class="sc">==</span> <span class="st">"VEPIIN (850–1300)"</span>))</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>relative_production_regions <span class="ot">&lt;-</span></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>  chaco_regions <span class="sc">%&gt;%</span></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>    relative_production <span class="sc">%&gt;%</span></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>    tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">region =</span> <span class="fu">names</span>(.),</span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">relative_productivity =</span> terra<span class="sc">::</span><span class="fu">as.list</span>(.)</span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">relative_productivity =</span> </span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>                    terra<span class="sc">::</span><span class="fu">extract</span>(</span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>                      relative_productivity,</span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>                      sf<span class="sc">::</span><span class="fu">st_as_sf</span>(geometry),</span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>                      <span class="at">fun =</span> mean,</span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>                      <span class="at">na.rm =</span> <span class="cn">TRUE</span>,</span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a>                      <span class="at">touches =</span> <span class="cn">TRUE</span>,</span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ID =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">unlist</span>()</span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%T&gt;%</span></span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a>  readr<span class="sc">::</span><span class="fu">write_excel_csv</span>(<span class="fu">paste0</span>(<span class="st">"data-derived/relative_productivity_"</span>, ppt_threshold, <span class="st">".csv"</span>))</span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Joining with `by = join_by(region)`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_map_array</span>(</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> niche_npp_periods[[<span class="fu">c</span>(<span class="st">"E CRS (850–1040)"</span>,</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"L CRS (1040–1150)"</span>,</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"P CRS (1150–1300)"</span>)]] <span class="sc">%&gt;%</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># purrr::map(\(x){x$`50%`}) %&gt;%</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># terra::rast() %&gt;%</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">crop</span>(chaco_basin,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">touches =</span> <span class="cn">FALSE</span>), </span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">10000</span>), </span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="st">"Niche-attenuated</span><span class="sc">\n</span><span class="st">Net Primary Productivity (kg C/ m²)"</span>,</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">labels =</span> \(x){x <span class="sc">*</span> <span class="fl">0.0001</span>}</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%T&gt;%</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="at">plot =</span> .,</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">filename =</span> <span class="fu">paste0</span>(<span class="st">"figures/Figure_s4_"</span>, ppt_threshold, <span class="st">".png"</span>),</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">device =</span> ragg<span class="sc">::</span>agg_png,</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">width =</span> fig_width, </span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">height =</span> fig_height,</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">bg =</span> <span class="st">"white"</span>,</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">dpi =</span> <span class="dv">600</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="suppfig-s4" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-suppfig figure">
<div aria-describedby="suppfig-s4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figures/Figure_s4-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="3000"></p>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-suppfig" id="suppfig-s4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure S4: Niche-attenuated Net Primary Productivity (NPP) during key cultural periods. We multiplied median pre-European NPP (the center map in Fig. S2) by the proportion of years each pixel met the Maize Farming Niche (MFN) criteria (&gt;250 mm precipitation and &gt;1000 GDD) for three time periods: Early Chaco (850–1040), Late Chaco (1040–1150), and Post-Chaco (1150–1300). These maps represent how climate variability constrained potential agricultural productivity.
</figcaption>
</figure>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_map_array</span>(</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> relative_production[[<span class="fu">c</span>(<span class="st">"E CRS (850–1040)"</span>,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"L CRS (1040–1150)"</span>,</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"P CRS (1150–1300)"</span>)]] <span class="sc">%&gt;%</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># purrr::map(\(x){x$`50%`}) %&gt;%</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># terra::rast() %&gt;%</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">crop</span>(chaco_basin,</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">touches =</span> <span class="cn">FALSE</span>), </span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">2</span>), </span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">Relative Production"</span>,</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">labels =</span> scales<span class="sc">::</span>percent</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%T&gt;%</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="at">plot =</span> .,</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">filename =</span> <span class="fu">paste0</span>(<span class="st">"figures/Figure_s5_"</span>, ppt_threshold, <span class="st">".png"</span>),</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">device =</span> ragg<span class="sc">::</span>agg_png,</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">width =</span> fig_width, </span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">height =</span> fig_height,</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">bg =</span> <span class="st">"white"</span>,</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">dpi =</span> <span class="dv">600</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="suppfig-s5" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-suppfig figure">
<div aria-describedby="suppfig-s5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figures/Figure_s5-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="3000"></p>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-suppfig" id="suppfig-s5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure S5: Relative productivity across Chacoan regions during key cultural periods. We scaled niche-attenuated NPP values from each time period relative to the average value in the Central Mesa Verde region (set to 1) to create a unitless measure of agricultural potential. This relative comparison highlights spatial differences in productive capacity across Chacoan regions from A.D. 850 to 1300.
</figcaption>
</figure>
</div>
<p>Finally, we bring all of the details together to calculate the statistics and demographic estimates presented in Table 2. See <a href="tables/Table_2_250.xlsx"><code>tables/Table_2_250.xlsx</code></a> for output.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>vepiin_area <span class="ot">&lt;-</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  chaco_regions <span class="sc">%&gt;%</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(region <span class="sc">==</span> <span class="st">"VEPIIN (850–1300)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_area</span>() <span class="sc">%&gt;%</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  units<span class="sc">::</span><span class="fu">set_units</span>(<span class="st">"km^2"</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>footnote <span class="ot">&lt;-</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ᵃas graphed in Schwindt et al. (2016:Figure 3)</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="st">ᵇcalculated as (Mean proportion potentially productive land, VEPIIN) x ~4,566 sq km</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="st">ᶜcalculated as (Mean potentially productive sq km, CRS) x (people/potentially productive sq km, VEPIIN) </span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="st">ᵈMomentary Population Estimate, CRS, x Average Productivity Relative to VEPIIN area</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="st">ᵉterminal date as used by Van Dyke et al. (2016); 1280 used here"</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>crs_niche <span class="ot">&lt;-</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>  maize_farming_niche <span class="sc">%&gt;%</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(<span class="at">.id =</span> <span class="st">"region"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">start =</span> <span class="fu">str_extract</span>(region, <span class="st">"</span><span class="sc">\\</span><span class="st">d+(?=–)"</span>),</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>                <span class="at">end =</span> <span class="fu">str_extract</span>(region, <span class="st">"(?&lt;=–)</span><span class="sc">\\</span><span class="st">d+"</span>),</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>                dplyr<span class="sc">::</span><span class="fu">across</span>(<span class="fu">c</span>(start, end), as.integer)) <span class="sc">%&gt;%</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">between</span>(year, start, end)) <span class="sc">%&gt;%</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(start, end, region) <span class="sc">%&gt;%</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Mean p potentially dry-farmable land, CRS</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mean</span>(mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(region) <span class="sc">%&gt;%</span></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">right_join</span>(</span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>    chaco_regions <span class="sc">%&gt;%</span></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Area =</span> sf<span class="sc">::</span><span class="fu">st_area</span>(geometry) <span class="sc">%&gt;%</span></span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>                      units<span class="sc">::</span><span class="fu">set_units</span>(<span class="st">"km^2"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>()</span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Mean potentially dry-farmable sq km, CRS</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Mean p potentially dry-farmable land, CRS</span><span class="st">`</span> <span class="sc">*</span> Area,</span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">factor</span>(region, </span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a>                    <span class="at">levels =</span> </span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">c</span>(</span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"E CRS (850–1040)"</span>,</span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"L CRS (1040–1150)"</span>,</span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"P CRS (1150–1300)"</span>,</span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"VEPIIN (850–1300)"</span></span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a>                      ),</span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ordered =</span> <span class="cn">TRUE</span></span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Joining with `by = join_by(region)`</span></span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a>vepiin_population <span class="ot">&lt;-</span></span>
<span id="cb17-50"><a href="#cb17-50" aria-hidden="true" tabindex="-1"></a>  readxl<span class="sc">::</span><span class="fu">read_excel</span>(<span class="st">"data-raw/Schwindt2016_Table2.xlsx"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-51"><a href="#cb17-51" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">`</span><span class="at">VEP Start</span><span class="st">`</span> <span class="ot">=</span> Start, </span>
<span id="cb17-52"><a href="#cb17-52" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">VEP End</span><span class="st">`</span> <span class="ot">=</span> End) <span class="sc">%&gt;%</span></span>
<span id="cb17-53"><a href="#cb17-53" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb17-54"><a href="#cb17-54" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">c</span>(<span class="st">`</span><span class="at">VEP Start</span><span class="st">`</span>, <span class="st">`</span><span class="at">VEP End</span><span class="st">`</span>),</span>
<span id="cb17-55"><a href="#cb17-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"type"</span>,</span>
<span id="cb17-56"><a href="#cb17-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"Momentary Population Estimate, VEPIINᵃ"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-57"><a href="#cb17-57" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">separate_wider_delim</span>(type, </span>
<span id="cb17-58"><a href="#cb17-58" aria-hidden="true" tabindex="-1"></a>                              <span class="at">delim =</span> <span class="st">" — "</span>, </span>
<span id="cb17-59"><a href="#cb17-59" aria-hidden="true" tabindex="-1"></a>                              <span class="at">names =</span> <span class="fu">c</span>(<span class="st">"subregion"</span>, <span class="st">"type"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb17-60"><a href="#cb17-60" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(subregion <span class="sc">==</span> <span class="st">"Study Area Total"</span>,</span>
<span id="cb17-61"><a href="#cb17-61" aria-hidden="true" tabindex="-1"></a>                type <span class="sc">!=</span> <span class="st">"80% CI"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-62"><a href="#cb17-62" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(<span class="st">`</span><span class="at">VEP Start</span><span class="st">`</span>,</span>
<span id="cb17-63"><a href="#cb17-63" aria-hidden="true" tabindex="-1"></a>                  <span class="st">`</span><span class="at">VEP End</span><span class="st">`</span>,</span>
<span id="cb17-64"><a href="#cb17-64" aria-hidden="true" tabindex="-1"></a>                  subregion) <span class="sc">%&gt;%</span></span>
<span id="cb17-65"><a href="#cb17-65" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb17-66"><a href="#cb17-66" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Momentary Population Estimate, VEPIINᵃ</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb17-67"><a href="#cb17-67" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sum</span>(<span class="st">`</span><span class="at">Momentary Population Estimate, VEPIINᵃ</span><span class="st">`</span>,</span>
<span id="cb17-68"><a href="#cb17-68" aria-hidden="true" tabindex="-1"></a>          <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb17-69"><a href="#cb17-69" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb17-70"><a href="#cb17-70" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">unite</span>(<span class="st">"VEP Periods (VEPIIN area ≈ 4,566 sq km)"</span>, </span>
<span id="cb17-71"><a href="#cb17-71" aria-hidden="true" tabindex="-1"></a>               <span class="fu">c</span>(<span class="st">`</span><span class="at">VEP Start</span><span class="st">`</span>,</span>
<span id="cb17-72"><a href="#cb17-72" aria-hidden="true" tabindex="-1"></a>                 <span class="st">`</span><span class="at">VEP End</span><span class="st">`</span>),</span>
<span id="cb17-73"><a href="#cb17-73" aria-hidden="true" tabindex="-1"></a>               <span class="at">sep =</span> <span class="st">" – "</span>,</span>
<span id="cb17-74"><a href="#cb17-74" aria-hidden="true" tabindex="-1"></a>               <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-75"><a href="#cb17-75" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>subregion) </span>
<span id="cb17-76"><a href="#cb17-76" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; `summarise()` has grouped output by 'VEP Start', 'VEP End'. You can override</span></span>
<span id="cb17-77"><a href="#cb17-77" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; using the `.groups` argument.</span></span>
<span id="cb17-78"><a href="#cb17-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-79"><a href="#cb17-79" aria-hidden="true" tabindex="-1"></a>vepiin_population <span class="sc">%&lt;&gt;%</span></span>
<span id="cb17-80"><a href="#cb17-80" aria-hidden="true" tabindex="-1"></a>  <span class="co"># dplyr::mutate(dplyr::across(c(`begin (CE)`, `end (CE)`), as.integer)) %&gt;%</span></span>
<span id="cb17-81"><a href="#cb17-81" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb17-82"><a href="#cb17-82" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">list</span>(tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">year =</span> <span class="st">`</span><span class="at">VEP Start</span><span class="st">`</span><span class="sc">:</span><span class="st">`</span><span class="at">VEP End</span><span class="st">`</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb17-83"><a href="#cb17-83" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">unnest</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb17-84"><a href="#cb17-84" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(maize_farming_niche<span class="sc">$</span><span class="st">`</span><span class="at">VEPIIN (850–1300)</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-85"><a href="#cb17-85" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(<span class="st">`</span><span class="at">VEP Start</span><span class="st">`</span>, <span class="st">`</span><span class="at">VEP End</span><span class="st">`</span>, <span class="st">`</span><span class="at">VEP Periods (VEPIIN area ≈ 4,566 sq km)</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-86"><a href="#cb17-86" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="st">`</span><span class="at">Mean p dry-farmable land, VEPIIN</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">mean</span>(mean),</span>
<span id="cb17-87"><a href="#cb17-87" aria-hidden="true" tabindex="-1"></a>                   <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-88"><a href="#cb17-88" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="st">`</span><span class="at">VEP Start</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-89"><a href="#cb17-89" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span><span class="fu">c</span>(<span class="st">`</span><span class="at">VEP Start</span><span class="st">`</span>, <span class="st">`</span><span class="at">VEP End</span><span class="st">`</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb17-90"><a href="#cb17-90" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(vepiin_population) <span class="sc">%&gt;%</span></span>
<span id="cb17-91"><a href="#cb17-91" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb17-92"><a href="#cb17-92" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">People/dry-farmable sq km, VEPIINᵇ</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb17-93"><a href="#cb17-93" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Momentary Population Estimate, VEPIINᵃ</span><span class="st">`</span> <span class="sc">/</span> </span>
<span id="cb17-94"><a href="#cb17-94" aria-hidden="true" tabindex="-1"></a>      (<span class="st">`</span><span class="at">Mean p dry-farmable land, VEPIIN</span><span class="st">`</span> <span class="sc">*</span> vepiin_area)</span>
<span id="cb17-95"><a href="#cb17-95" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb17-96"><a href="#cb17-96" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Joining with `by = join_by(year)`</span></span>
<span id="cb17-97"><a href="#cb17-97" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Joining with `by = join_by(`VEP Periods (VEPIIN area ≈ 4,566 sq km)`)`</span></span>
<span id="cb17-98"><a href="#cb17-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-99"><a href="#cb17-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-100"><a href="#cb17-100" aria-hidden="true" tabindex="-1"></a>vepiin_population_final <span class="ot">&lt;-</span></span>
<span id="cb17-101"><a href="#cb17-101" aria-hidden="true" tabindex="-1"></a>  vepiin_population <span class="sc">%&gt;%</span></span>
<span id="cb17-102"><a href="#cb17-102" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb17-103"><a href="#cb17-103" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">VEP Periods (VEPIIN area ≈ 4,566 sq km)</span><span class="st">`</span>,</span>
<span id="cb17-104"><a href="#cb17-104" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Mean p dry-farmable land, VEPIIN</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">round</span>(<span class="st">`</span><span class="at">Mean p dry-farmable land, VEPIIN</span><span class="st">`</span>, <span class="dv">2</span>),</span>
<span id="cb17-105"><a href="#cb17-105" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Momentary Population Estimate, VEPIINᵃ</span><span class="st">`</span> <span class="ot">=</span> scales<span class="sc">::</span><span class="fu">label_comma</span>()(<span class="st">`</span><span class="at">Momentary Population Estimate, VEPIINᵃ</span><span class="st">`</span>),</span>
<span id="cb17-106"><a href="#cb17-106" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">People/dry-farmable sq km, VEPIINᵇ</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">round</span>(units<span class="sc">::</span><span class="fu">drop_units</span>(<span class="st">`</span><span class="at">People/dry-farmable sq km, VEPIINᵇ</span><span class="st">`</span>), <span class="dv">2</span>),</span>
<span id="cb17-107"><a href="#cb17-107" aria-hidden="true" tabindex="-1"></a>    <span class="at">.keep =</span> <span class="st">"none"</span></span>
<span id="cb17-108"><a href="#cb17-108" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb17-109"><a href="#cb17-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-110"><a href="#cb17-110" aria-hidden="true" tabindex="-1"></a>crs_population_final <span class="ot">&lt;-</span></span>
<span id="cb17-111"><a href="#cb17-111" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">cross_join</span>(crs_niche, </span>
<span id="cb17-112"><a href="#cb17-112" aria-hidden="true" tabindex="-1"></a>                  vepiin_population) <span class="sc">%&gt;%</span></span>
<span id="cb17-113"><a href="#cb17-113" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb17-114"><a href="#cb17-114" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">between</span>(<span class="st">`</span><span class="at">VEP Start</span><span class="st">`</span>, start, end) <span class="sc">|</span> </span>
<span id="cb17-115"><a href="#cb17-115" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">between</span>(<span class="st">`</span><span class="at">VEP End</span><span class="st">`</span>, start, end)</span>
<span id="cb17-116"><a href="#cb17-116" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb17-117"><a href="#cb17-117" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(</span>
<span id="cb17-118"><a href="#cb17-118" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb17-119"><a href="#cb17-119" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">all_of</span>(</span>
<span id="cb17-120"><a href="#cb17-120" aria-hidden="true" tabindex="-1"></a>        <span class="fu">names</span>(crs_niche)</span>
<span id="cb17-121"><a href="#cb17-121" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb17-122"><a href="#cb17-122" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb17-123"><a href="#cb17-123" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb17-124"><a href="#cb17-124" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb17-125"><a href="#cb17-125" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Mean People/dry-farmable sq km, VEPIINᵇ</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb17-126"><a href="#cb17-126" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mean</span>(<span class="st">`</span><span class="at">People/dry-farmable sq km, VEPIINᵇ</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-127"><a href="#cb17-127" aria-hidden="true" tabindex="-1"></a>      units<span class="sc">::</span><span class="fu">drop_units</span>(),</span>
<span id="cb17-128"><a href="#cb17-128" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">SD People/dry-farmable sq km, VEPIINᵇ</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb17-129"><a href="#cb17-129" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sd</span>(<span class="st">`</span><span class="at">People/dry-farmable sq km, VEPIINᵇ</span><span class="st">`</span>),</span>
<span id="cb17-130"><a href="#cb17-130" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb17-131"><a href="#cb17-131" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb17-132"><a href="#cb17-132" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb17-133"><a href="#cb17-133" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">MPE, CRS, meanᶜ</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb17-134"><a href="#cb17-134" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Mean potentially dry-farmable sq km, CRS</span><span class="st">`</span> <span class="sc">*</span></span>
<span id="cb17-135"><a href="#cb17-135" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Mean People/dry-farmable sq km, VEPIINᵇ</span><span class="st">`</span>,</span>
<span id="cb17-136"><a href="#cb17-136" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">MPE, CRS, lowerᶜ</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb17-137"><a href="#cb17-137" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Mean potentially dry-farmable sq km, CRS</span><span class="st">`</span> <span class="sc">*</span></span>
<span id="cb17-138"><a href="#cb17-138" aria-hidden="true" tabindex="-1"></a>      (<span class="st">`</span><span class="at">Mean People/dry-farmable sq km, VEPIINᵇ</span><span class="st">`</span> <span class="sc">-</span> <span class="st">`</span><span class="at">SD People/dry-farmable sq km, VEPIINᵇ</span><span class="st">`</span>),</span>
<span id="cb17-139"><a href="#cb17-139" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">MPE, CRS, upperᶜ</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb17-140"><a href="#cb17-140" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Mean potentially dry-farmable sq km, CRS</span><span class="st">`</span> <span class="sc">*</span></span>
<span id="cb17-141"><a href="#cb17-141" aria-hidden="true" tabindex="-1"></a>      (<span class="st">`</span><span class="at">Mean People/dry-farmable sq km, VEPIINᵇ</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">SD People/dry-farmable sq km, VEPIINᵇ</span><span class="st">`</span>)</span>
<span id="cb17-142"><a href="#cb17-142" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb17-143"><a href="#cb17-143" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(region) <span class="sc">%&gt;%</span></span>
<span id="cb17-144"><a href="#cb17-144" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(relative_production_regions) <span class="sc">%&gt;%</span></span>
<span id="cb17-145"><a href="#cb17-145" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">`</span><span class="at">Average Productivity Relative to VEPIIN area</span><span class="st">`</span> <span class="ot">=</span> relative_productivity) <span class="sc">%&gt;%</span></span>
<span id="cb17-146"><a href="#cb17-146" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb17-147"><a href="#cb17-147" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">CMPE, CRS, meanᵈ</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb17-148"><a href="#cb17-148" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">MPE, CRS, meanᶜ</span><span class="st">`</span> <span class="sc">*</span> <span class="st">`</span><span class="at">Average Productivity Relative to VEPIIN area</span><span class="st">`</span>,</span>
<span id="cb17-149"><a href="#cb17-149" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">CMPE, CRS, lowerᵈ</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb17-150"><a href="#cb17-150" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">MPE, CRS, lowerᶜ</span><span class="st">`</span> <span class="sc">*</span> <span class="st">`</span><span class="at">Average Productivity Relative to VEPIIN area</span><span class="st">`</span>,</span>
<span id="cb17-151"><a href="#cb17-151" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">CMPE, CRS, upperᵈ</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb17-152"><a href="#cb17-152" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">MPE, CRS, upperᶜ</span><span class="st">`</span> <span class="sc">*</span> <span class="st">`</span><span class="at">Average Productivity Relative to VEPIIN area</span><span class="st">`</span>,</span>
<span id="cb17-153"><a href="#cb17-153" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Momentary Population Estimate, CRS, mean (range)ᶜ</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb17-154"><a href="#cb17-154" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(</span>
<span id="cb17-155"><a href="#cb17-155" aria-hidden="true" tabindex="-1"></a>        scales<span class="sc">::</span><span class="fu">label_comma</span>()(units<span class="sc">::</span><span class="fu">drop_units</span>(<span class="st">`</span><span class="at">MPE, CRS, meanᶜ</span><span class="st">`</span>)),</span>
<span id="cb17-156"><a href="#cb17-156" aria-hidden="true" tabindex="-1"></a>        <span class="st">" ("</span>,</span>
<span id="cb17-157"><a href="#cb17-157" aria-hidden="true" tabindex="-1"></a>        scales<span class="sc">::</span><span class="fu">label_comma</span>()(units<span class="sc">::</span><span class="fu">drop_units</span>(<span class="st">`</span><span class="at">MPE, CRS, lowerᶜ</span><span class="st">`</span>)),</span>
<span id="cb17-158"><a href="#cb17-158" aria-hidden="true" tabindex="-1"></a>        <span class="st">" – "</span>,</span>
<span id="cb17-159"><a href="#cb17-159" aria-hidden="true" tabindex="-1"></a>        scales<span class="sc">::</span><span class="fu">label_comma</span>()(units<span class="sc">::</span><span class="fu">drop_units</span>(<span class="st">`</span><span class="at">MPE, CRS, upperᶜ</span><span class="st">`</span>)),</span>
<span id="cb17-160"><a href="#cb17-160" aria-hidden="true" tabindex="-1"></a>        <span class="st">")"</span></span>
<span id="cb17-161"><a href="#cb17-161" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb17-162"><a href="#cb17-162" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">Corrected Momentary Population Estimate, CRS, mean (range)ᵈ</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb17-163"><a href="#cb17-163" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(</span>
<span id="cb17-164"><a href="#cb17-164" aria-hidden="true" tabindex="-1"></a>        scales<span class="sc">::</span><span class="fu">label_comma</span>()(units<span class="sc">::</span><span class="fu">drop_units</span>(<span class="st">`</span><span class="at">CMPE, CRS, meanᵈ</span><span class="st">`</span>)),</span>
<span id="cb17-165"><a href="#cb17-165" aria-hidden="true" tabindex="-1"></a>        <span class="st">" ("</span>,</span>
<span id="cb17-166"><a href="#cb17-166" aria-hidden="true" tabindex="-1"></a>        scales<span class="sc">::</span><span class="fu">label_comma</span>()(units<span class="sc">::</span><span class="fu">drop_units</span>(<span class="st">`</span><span class="at">CMPE, CRS, lowerᵈ</span><span class="st">`</span>)),</span>
<span id="cb17-167"><a href="#cb17-167" aria-hidden="true" tabindex="-1"></a>        <span class="st">" – "</span>,</span>
<span id="cb17-168"><a href="#cb17-168" aria-hidden="true" tabindex="-1"></a>        scales<span class="sc">::</span><span class="fu">label_comma</span>()(units<span class="sc">::</span><span class="fu">drop_units</span>(<span class="st">`</span><span class="at">CMPE, CRS, upperᵈ</span><span class="st">`</span>)),</span>
<span id="cb17-169"><a href="#cb17-169" aria-hidden="true" tabindex="-1"></a>        <span class="st">")"</span></span>
<span id="cb17-170"><a href="#cb17-170" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb17-171"><a href="#cb17-171" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">CRS Periods, dates, size</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb17-172"><a href="#cb17-172" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(</span>
<span id="cb17-173"><a href="#cb17-173" aria-hidden="true" tabindex="-1"></a>        region,</span>
<span id="cb17-174"><a href="#cb17-174" aria-hidden="true" tabindex="-1"></a>        <span class="st">", "</span>,</span>
<span id="cb17-175"><a href="#cb17-175" aria-hidden="true" tabindex="-1"></a>        scales<span class="sc">::</span><span class="fu">label_comma</span>()(units<span class="sc">::</span><span class="fu">drop_units</span>(Area)),</span>
<span id="cb17-176"><a href="#cb17-176" aria-hidden="true" tabindex="-1"></a>        <span class="st">" sq km"</span></span>
<span id="cb17-177"><a href="#cb17-177" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb17-178"><a href="#cb17-178" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">People/dry-farmable sq km, VEPIIN (mean ± SD)ᵇ</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb17-179"><a href="#cb17-179" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(</span>
<span id="cb17-180"><a href="#cb17-180" aria-hidden="true" tabindex="-1"></a>        <span class="fu">round</span>(<span class="st">`</span><span class="at">Mean People/dry-farmable sq km, VEPIINᵇ</span><span class="st">`</span>, <span class="dv">2</span>),</span>
<span id="cb17-181"><a href="#cb17-181" aria-hidden="true" tabindex="-1"></a>        <span class="st">" ± "</span>,</span>
<span id="cb17-182"><a href="#cb17-182" aria-hidden="true" tabindex="-1"></a>        <span class="fu">round</span>(<span class="st">`</span><span class="at">SD People/dry-farmable sq km, VEPIINᵇ</span><span class="st">`</span>, <span class="dv">2</span>)</span>
<span id="cb17-183"><a href="#cb17-183" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb17-184"><a href="#cb17-184" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Mean potentially dry-farmable sq km, CRS</span><span class="st">`</span> <span class="ot">=</span> </span>
<span id="cb17-185"><a href="#cb17-185" aria-hidden="true" tabindex="-1"></a>      scales<span class="sc">::</span><span class="fu">label_comma</span>()(units<span class="sc">::</span><span class="fu">drop_units</span>(<span class="st">`</span><span class="at">Mean potentially dry-farmable sq km, CRS</span><span class="st">`</span>))</span>
<span id="cb17-186"><a href="#cb17-186" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb17-187"><a href="#cb17-187" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="st">`</span><span class="at">CRS Periods, dates, size</span><span class="st">`</span>, </span>
<span id="cb17-188"><a href="#cb17-188" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">People/dry-farmable sq km, VEPIIN (mean ± SD)ᵇ</span><span class="st">`</span>,</span>
<span id="cb17-189"><a href="#cb17-189" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">Mean p potentially dry-farmable land, CRS</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">round</span>(<span class="st">`</span><span class="at">Mean p potentially dry-farmable land, CRS</span><span class="st">`</span>, <span class="dv">3</span>),</span>
<span id="cb17-190"><a href="#cb17-190" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">Mean potentially dry-farmable sq km, CRS</span><span class="st">`</span>,</span>
<span id="cb17-191"><a href="#cb17-191" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">Momentary Population Estimate, CRS, mean (range)ᶜ</span><span class="st">`</span>,</span>
<span id="cb17-192"><a href="#cb17-192" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">Average Productivity Relative to VEPIIN area</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">round</span>(<span class="st">`</span><span class="at">Average Productivity Relative to VEPIIN area</span><span class="st">`</span>, <span class="dv">2</span>),</span>
<span id="cb17-193"><a href="#cb17-193" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">Corrected Momentary Population Estimate, CRS, mean (range)ᵈ</span><span class="st">`</span>,</span>
<span id="cb17-194"><a href="#cb17-194" aria-hidden="true" tabindex="-1"></a>                <span class="at">.keep =</span> <span class="st">"none"</span></span>
<span id="cb17-195"><a href="#cb17-195" aria-hidden="true" tabindex="-1"></a>                ) <span class="sc">%&gt;%</span></span>
<span id="cb17-196"><a href="#cb17-196" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="st">`</span><span class="at">CRS Periods, dates, size</span><span class="st">`</span>, </span>
<span id="cb17-197"><a href="#cb17-197" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">People/dry-farmable sq km, VEPIIN (mean ± SD)ᵇ</span><span class="st">`</span>,</span>
<span id="cb17-198"><a href="#cb17-198" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">Mean p potentially dry-farmable land, CRS</span><span class="st">`</span>,</span>
<span id="cb17-199"><a href="#cb17-199" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">Mean potentially dry-farmable sq km, CRS</span><span class="st">`</span>,</span>
<span id="cb17-200"><a href="#cb17-200" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">Momentary Population Estimate, CRS, mean (range)ᶜ</span><span class="st">`</span>,</span>
<span id="cb17-201"><a href="#cb17-201" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">Average Productivity Relative to VEPIIN area</span><span class="st">`</span>,</span>
<span id="cb17-202"><a href="#cb17-202" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">Corrected Momentary Population Estimate, CRS, mean (range)ᵈ</span><span class="st">`</span>)</span>
<span id="cb17-203"><a href="#cb17-203" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Joining with `by = join_by(region)`</span></span>
<span id="cb17-204"><a href="#cb17-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-205"><a href="#cb17-205" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(</span>
<span id="cb17-206"><a href="#cb17-206" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">VEPIIN</span><span class="st">`</span> <span class="ot">=</span> vepiin_population_final,</span>
<span id="cb17-207"><a href="#cb17-207" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Chaco Regional System</span><span class="st">`</span> <span class="ot">=</span> crs_population_final</span>
<span id="cb17-208"><a href="#cb17-208" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb17-209"><a href="#cb17-209" aria-hidden="true" tabindex="-1"></a>    openxlsx<span class="sc">::</span><span class="fu">write.xlsx</span>(</span>
<span id="cb17-210"><a href="#cb17-210" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">"tables/Table_2_"</span>, ppt_threshold, <span class="st">".xlsx"</span>),</span>
<span id="cb17-211"><a href="#cb17-211" aria-hidden="true" tabindex="-1"></a>      <span class="at">asTable =</span> <span class="cn">TRUE</span>,</span>
<span id="cb17-212"><a href="#cb17-212" aria-hidden="true" tabindex="-1"></a>      <span class="at">colWidths =</span> <span class="st">"auto"</span></span>
<span id="cb17-213"><a href="#cb17-213" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<details>
<summary>
Session Info
</summary>
<div class="cell" data-layout-align="center">
<pre><code>#&gt; ─ Session info ───────────────────────────────────────────────────────────────
#&gt;  setting  value
#&gt;  version  R version 4.5.1 (2025-06-13)
#&gt;  os       macOS Sequoia 15.5
#&gt;  system   aarch64, darwin20
#&gt;  ui       X11
#&gt;  language (EN)
#&gt;  collate  en_US.UTF-8
#&gt;  ctype    en_US.UTF-8
#&gt;  tz       America/Denver
#&gt;  date     2025-07-10
#&gt;  pandoc   3.7.0.2 @ /opt/homebrew/bin/ (via rmarkdown)
#&gt;  quarto   1.7.32 @ /usr/local/bin/quarto
#&gt; 
#&gt; ─ Packages ───────────────────────────────────────────────────────────────────
#&gt;  package   * version date (UTC) lib source
#&gt;  dplyr     * 1.1.4   2023-11-17 [1] CRAN (R 4.5.0)
#&gt;  forcats   * 1.0.0   2023-01-29 [1] CRAN (R 4.5.0)
#&gt;  furrr     * 0.3.1   2022-08-15 [1] CRAN (R 4.5.0)
#&gt;  future    * 1.58.0  2025-06-05 [1] CRAN (R 4.5.0)
#&gt;  ggplot2   * 3.5.2   2025-04-09 [1] CRAN (R 4.5.0)
#&gt;  lightgbm  * 4.6.0   2025-02-13 [1] CRAN (R 4.5.0)
#&gt;  lubridate * 1.9.4   2024-12-08 [1] CRAN (R 4.5.0)
#&gt;  magrittr  * 2.0.3   2022-03-30 [1] CRAN (R 4.5.0)
#&gt;  openxlsx  * 4.2.8   2025-01-25 [1] CRAN (R 4.5.0)
#&gt;  pak       * 0.9.0   2025-05-27 [1] CRAN (R 4.5.0)
#&gt;  purrr     * 1.0.4   2025-02-05 [1] CRAN (R 4.5.0)
#&gt;  readr     * 2.1.5   2024-01-10 [1] CRAN (R 4.5.0)
#&gt;  sbtools   * 1.4.0   2025-07-07 [1] CRAN (R 4.5.0)
#&gt;  sf        * 1.0-21  2025-05-15 [1] CRAN (R 4.5.0)
#&gt;  slider    * 0.3.2   2024-10-25 [1] CRAN (R 4.5.0)
#&gt;  stringr   * 1.5.1   2023-11-14 [1] CRAN (R 4.5.0)
#&gt;  terra     * 1.8-54  2025-06-01 [1] CRAN (R 4.5.0)
#&gt;  tibble    * 3.3.0   2025-06-08 [1] CRAN (R 4.5.0)
#&gt;  tidyr     * 1.3.1   2024-01-24 [1] CRAN (R 4.5.0)
#&gt;  tidyterra * 0.7.2   2025-04-14 [1] CRAN (R 4.5.0)
#&gt;  tidyverse * 2.0.0   2023-02-22 [1] CRAN (R 4.5.0)
#&gt; 
#&gt;  [1] /Users/kyle.bocinsky/Library/R/arm64/4.5/library
#&gt;  [2] /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library
#&gt;  * ── Packages attached to the search path.
#&gt; 
#&gt; ──────────────────────────────────────────────────────────────────────────────</code></pre>
</div>
</details></section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>